<!doctype html> <html class="theme-default typo-default" lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <meta content=#159794 name=theme-color> <base href=/ > <link href=global.css rel=stylesheet> <link href=prism.css rel=stylesheet> <link href=manifest.json rel=manifest> <link href=favicon.png rel=icon type=image/png> <meta content=summary_large_image name=twitter:card> <meta content=@sveltejs name=twitter:site> <meta content=@sveltejs name=twitter:creator> <meta content=https://sapper.svelte.dev/images/twitter-card.png name=twitter:image> <meta content=https://svelte.dev/images/twitter-card.png name=og:image> <link href=client/main.1822716073.css rel=stylesheet><link href=client/client.2a1e3520.css rel=stylesheet> <style>.hljs,.hljs-subst{color:#333}.hljs-comment{color:#999}.hljs-tag{color:#170}.hljs-keyword{color:#708}.hljs-attr{color:#333}.hljs-number{color:#164}.hljs-deletion,.hljs-quote,.hljs-selector-class,.hljs-selector-id,.hljs-string,.hljs-template-tag,.hljs-type{color:#105e10}.hljs-section,.hljs-title{color:#105e10}.hljs-literal{color:#170}.hljs-meta{color:#555}.hljs-meta-string{color:#555}</style> <noscript id=sapper-head-start></noscript><title>Docs • Sapper</title><meta content="Sapper docs" name=twitter:title><meta content="The next small thing in web development" name=twitter:description><meta content="The next small thing in web development" name=Description><noscript id=sapper-head-end></noscript> </head> <body> <div id=sapper> <div style=display:none> <svg><symbol class=icon id=arrow-left viewBox="0 0 24 24"><line x1=19 x2=5 y1=12 y2=12></line><polyline points="12 19 5 12 12 5"></polyline></symbol><symbol class=icon id=arrow-right viewBox="0 0 24 24"><line x1=5 x2=19 y1=12 y2=12></line><polyline points="12 5 19 12 12 19"></polyline></symbol><symbol class=icon id=arrow-up viewBox="0 0 24 24"><line x1=12 x2=12 y1=19 y2=5></line><polyline points="5 12 12 5 19 12"></polyline></symbol><symbol class=icon id=arrow-down viewBox="0 0 24 24"><line x1=12 x2=12 y1=5 y2=19></line><polyline points="19 12 12 19 5 12"></polyline></symbol><symbol class=icon id=check viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline></symbol><symbol class=icon id=close viewBox="0 0 24 24"><line x1=18 x2=6 y1=6 y2=18></line><line x1=6 x2=18 y1=6 y2=18></line></symbol><symbol class=icon id=download viewBox="0 0 24 24"><path d="M21 15V19A2 2 0 0 1 19 21H5A2 2 0 0 1 3 19V15"></path><polyline points="7 10 12 15 17 10"></polyline><line x1=12 x2=12 y1=15 y2=3></line></symbol><symbol class=icon id=edit viewBox="0 0 24 24"><path d="M20 14.66V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h5.34"></path><polygon points="18 2 22 6 12 16 8 16 8 12 18 2"></polygon></symbol><symbol class=icon id=github viewBox="0 0 24 24"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></symbol><symbol class=icon id=git-branch viewBox="0 0 24 24"><line x1=6 x2=6 y1=3 y2=15></line><circle cx=18 cy=6 r=3></circle><circle cx=6 cy=18 r=3></circle><path d="M18 9a9 9 0 0 1-9 9"></path></symbol><symbol class=icon id=log-in viewBox="0 0 24 24"><path d="M15 3H19A2 2 0 0 1 21 5V19A2 2 0 0 1 19 21H15"></path><polyline points="10 17 15 12 10 7"></polyline><line x1=15 x2=3 y1=12 y2=12></line></symbol><symbol class=icon id=maximize viewBox="0 0 24 24"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path></symbol><symbol class=icon id=maximize-2 viewBox="0 0 24 24"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1=21 x2=14 y1=3 y2=10></line><line x1=3 x2=10 y1=21 y2=14></line></symbol><symbol class=icon id=menu viewBox="0 0 24 24"><line x1=3 x2=21 y1=12 y2=12></line><line x1=3 x2=21 y1=6 y2=6></line><line x1=3 x2=21 y1=18 y2=18></line></symbol><symbol class=icon id=message-square viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></symbol><symbol class=icon id=minus viewBox="0 0 24 24"><line x1=5 x2=19 y1=12 y2=12></line></symbol><symbol class=icon id=plus viewBox="0 0 24 24"><line x1=12 x2=12 y1=5 y2=19></line><line x1=5 x2=19 y1=12 y2=12></line></symbol><symbol class=icon id=save viewBox="0 0 24 24"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></symbol><symbol class=icon id=link viewBox="0 0 24 24"><path d="M9,7L6,7A2 2 0 0 0 6,17L9,17"></path><path d="M15,7L18,7A2 2 0 0 1 18,17L15,17"></path><path d=M7,12L17,12></path></symbol><symbol class=icon id=chevron viewBox="0 0 24 24"><path d="M2,7 L12,17 L20,7"></path></symbol></svg></div> <header class="svelte-1txnqye visible"><nav class=svelte-1txnqye><a href=. class="svelte-1txnqye home" title=Homepage rel=prefetch style=background-image:url(sapper-logo-horizontal.svg)>Home</a> <ul class="svelte-1txnqye primary"><li class="svelte-1txnqye hide-if-desktop"><a href=. class=svelte-1txnqye rel=prefetch>Home</a></li> <li><a href=docs rel=prefetch>Docs</a></li> <li><a href=faq rel=prefetch>FAQ</a></li> <li><a href=https://svelte.dev>Svelte</a></li> <li><a href=https://svelte.dev/chat title="Discord Chat"> <svg class="icon svelte-5yec89" height=20 width=20><use xlink:href=#message-square></use></svg></a></li> <li><a href=https://github.com/sveltejs/sapper title="GitHub Repo"> <svg class="icon svelte-5yec89" height=20 width=20><use xlink:href=#github></use></svg></a></ul></nav></header> <main class=svelte-d6kcga> <div class="svelte-a3bmb2 content listify"><section class=svelte-a3bmb2 data-id=Introduction><h2 class=svelte-a3bmb2><span class=offset-anchor id=Introduction></span> <a href=docs#Introduction class=anchor aria-hidden></a> Introduction <small class=svelte-a3bmb2><a href=https://github.com/sveltejs/sapper/edit/master/site/content/docs/00-introduction.md class=svelte-a3bmb2 title="edit this section"> <svg class="icon svelte-5yec89" height=20 width=20><use xlink:href=#edit></use></svg></a> </small></h2> <h3> <span class=offset-anchor id=Before_we_begin></span> <a href=docs#Before_we_begin class=anchor aria-hidden=true></a> Before we begin </h3><blockquote> <p>Sapper is in early development, and some things may change before we hit version 1.0. This document is a work-in-progress. If you get stuck, reach out for help in the <a href=https://svelte.dev/chat rel="noopener noreferrer" target=_blank>Discord chatroom</a>.</p> <p>See the <a href=migrating rel="noopener noreferrer">migration guides</a> for help upgrading from older versions.</p> </blockquote> <h3> <span class=offset-anchor id=What_is_Sapper></span> <a href=docs#What_is_Sapper class=anchor aria-hidden=true></a> What is Sapper? </h3><p>Sapper is a framework for building extremely high-performance web apps. You're looking at one right now! There are two basic concepts:</p> <ul> <li>Each page of your app is a <a href=https://svelte.dev rel="noopener noreferrer" target=_blank>Svelte</a> component</li> <li>You create pages by adding files to the <code>src/routes</code> directory of your project. These will be server-rendered so that a user's first visit to your app is as fast as possible, then a client-side app takes over</li> </ul> <p>Building an app with all the modern best practices — code-splitting, offline support, server-rendered views with client-side hydration — is fiendishly complicated. Sapper does all the boring stuff for you so that you can get on with the creative part.</p> <p>You don't need to know Svelte to understand the rest of this guide, but it will help. In short, it's a UI framework that compiles your components to highly optimized vanilla JavaScript. Read the <a href=https://svelte.dev/blog/svelte-3-rethinking-reactivity rel="noopener noreferrer" target=_blank>introductory blog post</a> and the <a href=https://svelte.dev/tutorial rel="noopener noreferrer" target=_blank>tutorial</a> to learn more.</p> <h3> <span class=offset-anchor id=Why_the_name></span> <a href=docs#Why_the_name class=anchor aria-hidden=true></a> Why the name? </h3><p>In war, the soldiers who build bridges, repair roads, clear minefields and conduct demolitions — all under combat conditions — are known as <em>sappers</em>.</p> <p>For web developers, the stakes are generally lower than for combat engineers. But we face our own hostile environment: underpowered devices, poor network connections, and the complexity inherent in front-end engineering. Sapper, which is short for <b>S</b>velte <b>app</b> mak<b>er</b>, is your courageous and dutiful ally.</p> <h3> <span class=offset-anchor id=Comparison_with_Next_js></span> <a href=docs#Comparison_with_Next_js class=anchor aria-hidden=true></a> Comparison with Next.js </h3><p><a href=https://github.com/zeit/next.js rel="noopener noreferrer" target=_blank>Next.js</a> is a React framework from <a href=https://vercel.com rel="noopener noreferrer" target=_blank>Vercel (formerly ZEIT)</a>, and is the inspiration for Sapper. There are a few notable differences, however:</p> <ul> <li>Sapper is powered by Svelte instead of React, so it's faster and your apps are smaller</li> <li>As well as <em>pages</em>, you can create <em>server routes</em> in your <code>src/routes</code> directory. This makes it very easy to, for example, add a JSON API such as the one powering this very page (try visiting <a href=/docs.json rel="noopener noreferrer">/docs.json</a>)</li> <li>Links are just <code>&lt;a></code> elements, rather than framework-specific <code>&lt;Link></code> components. That means, for example, that <a href=/ rel="noopener noreferrer">this link right here</a>, despite being inside a blob of markdown, works with the router as you'd expect</li> </ul> <h3> <span class=offset-anchor id=Getting_started></span> <a href=docs#Getting_started class=anchor aria-hidden=true></a> Getting started </h3><p>The easiest way to start building a Sapper app is to clone the <a href=https://github.com/sveltejs/sapper-template rel="noopener noreferrer" target=_blank>sapper-template</a> repo with <a href=https://github.com/Rich-Harris/degit rel="noopener noreferrer" target=_blank>degit</a>:</p> <div class=""><pre class=language-bash><code>npx degit <span class=hljs-string>"sveltejs/sapper-template#rollup"</span> my-app
<span class=hljs-comment># or: npx degit "sveltejs/sapper-template#webpack" my-app</span>
<span class=hljs-built_in>cd</span> my-app
npm install
npm run dev</code></pre></div><p>This will scaffold a new project in the <code>my-app</code> directory, install its dependencies, and start a server on <a href=http://localhost:3000 rel="noopener noreferrer" target=_blank>localhost:3000</a>. Try editing the files to get a feel for how everything works – you may not need to bother reading the rest of this guide!</p> </section><section class=svelte-a3bmb2 data-id=Sapper_app_structure><h2 class=svelte-a3bmb2><span class=offset-anchor id=Sapper_app_structure></span> <a href=docs#Sapper_app_structure class=anchor aria-hidden></a> Sapper app structure <small class=svelte-a3bmb2><a href=https://github.com/sveltejs/sapper/edit/master/site/content/docs/01-structure.md class=svelte-a3bmb2 title="edit this section"> <svg class="icon svelte-5yec89" height=20 width=20><use xlink:href=#edit></use></svg></a> </small></h2> <p>This section is a reference for the curious. We recommend you play around with the project template first, and come back here when you've got a feel for how things fit together.</p> <p>If you take a look inside the <a href=https://github.com/sveltejs/sapper-template rel="noopener noreferrer" target=_blank>sapper-template</a> repo, you'll see some files that Sapper expects to find:</p> <div class=""><pre class=language-bash><code>├ package.json
├ src
│ ├ routes
│ │ ├ <span class=hljs-comment># your routes here</span>
│ │ ├ _error.svelte
│ │ └ index.svelte
│ ├ client.js
│ ├ server.js
│ ├ service-worker.js
│ └ template.html
├ static
│ ├ <span class=hljs-comment># your files here</span>
└ rollup.config.js / webpack.config.js</code></pre></div><p>When you first run Sapper, it will create an additional <code>__sapper__</code> directory containing generated files.</p> <p>You'll notice a few extra files and a <code>cypress</code> directory which relates to <a href=docs#Testing rel="noopener noreferrer">testing</a> — we don't need to worry about those right now.</p> <blockquote> <p>You <em>can</em> create these files from scratch, but it's much better to use the template. See <a href=docs#Getting_started rel="noopener noreferrer">getting started</a> for instructions on how to easily clone it</p> </blockquote> <h3> <span class=offset-anchor id=package_json></span> <a href=docs#package_json class=anchor aria-hidden=true></a> package.json </h3><p>Your package.json contains your app's dependencies and defines a number of scripts:</p> <ul> <li><code>npm run dev</code> — start the app in development mode, and watch source files for changes</li> <li><code>npm run build</code> — build the app in production mode</li> <li><code>npm run export</code> — bake out a static version, if applicable (see <a href=docs#Exporting rel="noopener noreferrer">exporting</a>)</li> <li><code>npm start</code> — start the app in production mode after you've built it</li> <li><code>npm test</code> — run the tests (see <a href=docs#Testing rel="noopener noreferrer">testing</a>)</li> </ul> <h3> <span class=offset-anchor id=src></span> <a href=docs#src class=anchor aria-hidden=true></a> src </h3><p>This contains the three <em>entry points</em> for your app — <code>src/client.js</code>, <code>src/server.js</code> and (optionally) <code>src/service-worker.js</code> — along with a <code>src/template.html</code> file.</p> <h4> <span class=offset-anchor id=src_client_js></span> <a href=docs#src_client_js class=anchor aria-hidden=true></a> src/client.js </h4><p>This <em>must</em> import, and call, the <code>start</code> function from the generated <code>@sapper/app</code> module:</p> <div class=""><pre class=language-javascript><code><span class=hljs-keyword>import</span> * <span class=hljs-keyword>as</span> sapper <span class=hljs-keyword>from</span> <span class=hljs-string>'@sapper/app'</span>;

sapper.start({
	<span class=hljs-attr>target</span>: <span class=hljs-built_in>document</span>.querySelector(<span class=hljs-string>'#sapper'</span>)
});</code></pre></div><p>In many cases, that's the entirety of your entry module, though you can do as much or as little here as you wish. See the <a href=docs#Client_API rel="noopener noreferrer">client API</a> section for more information on functions you can import.</p> <h4> <span class=offset-anchor id=src_server_js></span> <a href=docs#src_server_js class=anchor aria-hidden=true></a> src/server.js </h4><p>This is a normal Express (or <a href=https://github.com/lukeed/polka rel="noopener noreferrer" target=_blank>Polka</a>, etc) app, with three requirements:</p> <ul> <li>it should serve the contents of the <code>static</code> folder, using for example <a href=https://github.com/lukeed/sirv rel="noopener noreferrer" target=_blank>sirv</a></li> <li>it should call <code>app.use(sapper.middleware())</code> at the end, where <code>sapper</code> is imported from <code>@sapper/server</code></li> <li>it must listen on <code>process.env.PORT</code></li> </ul> <p>Beyond that, you can write the server however you like.</p> <h4> <span class=offset-anchor id=src_service-worker_js></span> <a href=docs#src_service-worker_js class=anchor aria-hidden=true></a> src/service-worker.js </h4><p>Service workers act as proxy servers that give you fine-grained control over how to respond to network requests. For example, when the browser requests <code>/goats.jpg</code>, the service worker can respond with a file it previously cached, or it can pass the request on to the server, or it could even respond with something completely different, such as a picture of llamas.</p> <p>Among other things, this makes it possible to build applications that work offline.</p> <p>Because every app needs a slightly different service worker (sometimes it's appropriate to always serve from the cache, sometimes that should only be a last resort in case of no connectivity), Sapper doesn't attempt to control the service worker. Instead, you write the logic in <code>service-worker.js</code>. You can import any of the following from <code>@sapper/service-worker</code>:</p> <ul> <li><code>files</code> — an array of files found in the <code>static</code> directory</li> <li><code>shell</code> — the client-side JavaScript generated by the bundler (Rollup or webpack)</li> <li><code>routes</code> — an array of <code>{ pattern: RegExp }</code> objects you can use to determine whether a Sapper-controlled page is being requested</li> <li><code>timestamp</code> — the time the service worker was generated (useful for generating unique cache names)</li> </ul> <h4> <span class=offset-anchor id=src_template_html></span> <a href=docs#src_template_html class=anchor aria-hidden=true></a> src/template.html </h4><p>This file is a template for responses from the server. Sapper will inject content that replaces the following tags:</p> <ul> <li><code>%sapper.base%</code> — a <code>&lt;base></code> element (see <a href=docs#Base_URLs rel="noopener noreferrer">base URLs</a>)</li> <li><code>%sapper.styles%</code> — critical CSS for the page being requested</li> <li><code>%sapper.head%</code> — HTML representing page-specific <code>&lt;head></code> contents, like <code>&lt;title></code></li> <li><code>%sapper.html%</code> — HTML representing the body of the page being rendered</li> <li><code>%sapper.scripts%</code> — script tags for the client-side app</li> </ul> <h3> <span class=offset-anchor id=src_routes></span> <a href=docs#src_routes class=anchor aria-hidden=true></a> src/routes </h3><p>This is the meat of your app — the pages and server routes. See the section on <a href=docs#Routing rel="noopener noreferrer">routing</a> for the juicy details.</p> <h3> <span class=offset-anchor id=static></span> <a href=docs#static class=anchor aria-hidden=true></a> static </h3><p>This is a place to put any files that your app uses — fonts, images and so on. For example <code>static/favicon.png</code> will be served as <code>/favicon.png</code>.</p> <p>Sapper doesn't serve these files — you'd typically use <a href=https://github.com/lukeed/sirv rel="noopener noreferrer" target=_blank>sirv</a> or <a href=https://github.com/expressjs/serve-static rel="noopener noreferrer" target=_blank>serve-static</a> for that — but it will read the contents of the <code>static</code> folder so that you can easily generate a cache manifest for offline support (see <a href=docs#src_service-worker_js rel="noopener noreferrer">service-worker.js</a>).</p> <h3> <span class=offset-anchor id=rollup_config_js_webpack_config_js></span> <a href=docs#rollup_config_js_webpack_config_js class=anchor aria-hidden=true></a> rollup.config.js / webpack.config.js </h3><p>Sapper can use <a href=https://rollupjs.org/ rel="noopener noreferrer" target=_blank>Rollup</a> or <a href=https://webpack.js.org/ rel="noopener noreferrer" target=_blank>webpack</a> to bundle your app. You probably won't need to change the config, but if you want to (for example to add new loaders or plugins), you can.</p> </section><section class=svelte-a3bmb2 data-id=Routing><h2 class=svelte-a3bmb2><span class=offset-anchor id=Routing></span> <a href=docs#Routing class=anchor aria-hidden></a> Routing <small class=svelte-a3bmb2><a href=https://github.com/sveltejs/sapper/edit/master/site/content/docs/02-routing.md class=svelte-a3bmb2 title="edit this section"> <svg class="icon svelte-5yec89" height=20 width=20><use xlink:href=#edit></use></svg></a> </small></h2> <p>As we've seen, there are two types of route in Sapper — pages, and server routes.</p> <h3> <span class=offset-anchor id=Pages></span> <a href=docs#Pages class=anchor aria-hidden=true></a> Pages </h3><p>Pages are Svelte components written in <code>.svelte</code> files. When a user first visits the application, they will be served a server-rendered version of the route in question, plus some JavaScript that 'hydrates' the page and initialises a client-side router. From that point forward, navigating to other pages is handled entirely on the client for a fast, app-like feel.</p> <p>The filename determines the route. For example, <code>src/routes/index.svelte</code> is the root of your site:</p> <div class=""><pre class=language-markup><code><span class=hljs-comment>&lt;!-- src/routes/index.svelte --></span>
<span class=hljs-tag>&lt;<span class=hljs-name>svelte:head</span>></span>
	<span class=hljs-tag>&lt;<span class=hljs-name>title</span>></span>Welcome<span class=hljs-tag>&lt;/<span class=hljs-name>title</span>></span>
<span class=hljs-tag>&lt;/<span class=hljs-name>svelte:head</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>h1</span>></span>Hello and welcome to my site!<span class=hljs-tag>&lt;/<span class=hljs-name>h1</span>></span></code></pre></div><p>A file called either <code>src/routes/about.svelte</code> or <code>src/routes/about/index.svelte</code> would correspond to the <code>/about</code> route:</p> <div class=""><pre class=language-markup><code><span class=hljs-comment>&lt;!-- src/routes/about.svelte --></span>
<span class=hljs-tag>&lt;<span class=hljs-name>svelte:head</span>></span>
	<span class=hljs-tag>&lt;<span class=hljs-name>title</span>></span>About<span class=hljs-tag>&lt;/<span class=hljs-name>title</span>></span>
<span class=hljs-tag>&lt;/<span class=hljs-name>svelte:head</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>h1</span>></span>About this site<span class=hljs-tag>&lt;/<span class=hljs-name>h1</span>></span>
<span class=hljs-tag>&lt;<span class=hljs-name>p</span>></span>TODO...<span class=hljs-tag>&lt;/<span class=hljs-name>p</span>></span></code></pre></div><p>Dynamic parameters are encoded using <code>[brackets]</code>. For example, here's how you could create a page that renders a blog post:</p> <div class=""><pre class=language-markup><code><span class=hljs-comment>&lt;!-- src/routes/blog/[slug].svelte --></span>
<span class=hljs-tag>&lt;<span class=hljs-name>script</span> <span class=hljs-attr>context</span>=<span class=hljs-string>"module"</span>></span><span class=javascript>
	<span class=hljs-comment>// the (optional) preload function takes a</span>
	<span class=hljs-comment>// `{ path, params, query }` object and turns it into</span>
	<span class=hljs-comment>// the data we need to render the page</span>
	<span class=hljs-keyword>export</span> <span class=hljs-keyword>async</span> <span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>preload</span>(<span class=hljs-params>page, session</span>) </span>{
		<span class=hljs-comment>// the `slug` parameter is available because this file</span>
		<span class=hljs-comment>// is called [slug].svelte</span>
		<span class=hljs-keyword>const</span> { slug } = page.params;

		<span class=hljs-comment>// `this.fetch` is a wrapper around `fetch` that allows</span>
		<span class=hljs-comment>// you to make credentialled requests on both</span>
		<span class=hljs-comment>// server and client</span>
		<span class=hljs-keyword>const</span> res = <span class=hljs-keyword>await</span> <span class=hljs-keyword>this</span>.fetch(<span class=hljs-string>`blog/<span class=hljs-subst>${slug}</span>.json`</span>);
		<span class=hljs-keyword>const</span> article = <span class=hljs-keyword>await</span> res.json();

		<span class=hljs-keyword>return</span> { article };
	}
</span><span class=hljs-tag>&lt;/<span class=hljs-name>script</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>script</span>></span><span class=javascript>
	<span class=hljs-keyword>export</span> <span class=hljs-keyword>let</span> article;
</span><span class=hljs-tag>&lt;/<span class=hljs-name>script</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>svelte:head</span>></span>
	<span class=hljs-tag>&lt;<span class=hljs-name>title</span>></span>{article.title}<span class=hljs-tag>&lt;/<span class=hljs-name>title</span>></span>
<span class=hljs-tag>&lt;/<span class=hljs-name>svelte:head</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>h1</span>></span>{article.title}<span class=hljs-tag>&lt;/<span class=hljs-name>h1</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>div</span> <span class=hljs-attr>class</span>=<span class=hljs-string>'content'</span>></span>
	{@html article.html}
<span class=hljs-tag>&lt;/<span class=hljs-name>div</span>></span></code></pre></div><p>If you want to capture more params, you can create nested folders using the same naming convention: <code>[slug]/[language]</code>.</p> <p>If you don't want to create several folders to capture more than one parameter like <code>[year]/[month]/...</code>, or if the number of parameters is dynamic, you can use a spread route parameter. For example, instead of individually capturing <code>/blog/[slug]/[year]/[month]/[day]</code>, you can create a file for <code>/blog/[...slug].svelte</code> and extract the params like so:</p> <div class=""><pre class=language-markup><code><span class=hljs-comment>&lt;!-- src/routes/blog/[...slug].svelte --></span>
<span class=hljs-tag>&lt;<span class=hljs-name>script</span> <span class=hljs-attr>context</span>=<span class=hljs-string>"module"</span>></span><span class=javascript>
	<span class=hljs-keyword>export</span> <span class=hljs-keyword>async</span> <span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>preload</span>(<span class=hljs-params>{ params }</span>) </span>{
		<span class=hljs-keyword>let</span> [slug, year, month, day] = params.slug;

		<span class=hljs-keyword>return</span> { slug, year, month, day };
	}
</span><span class=hljs-tag>&lt;/<span class=hljs-name>script</span>></span></code></pre></div><blockquote> <p>See the section on <a href=docs#Preloading rel="noopener noreferrer">preloading</a> for more info about <code>preload</code> and <code>this.fetch</code></p> </blockquote> <h3> <span class=offset-anchor id=Server_routes></span> <a href=docs#Server_routes class=anchor aria-hidden=true></a> Server routes </h3><p>Server routes are modules written in <code>.js</code> files that export functions corresponding to HTTP methods. Each function receives HTTP <code>request</code> and <code>response</code> objects as arguments, plus a <code>next</code> function. This is useful for creating a JSON API. For example, here's how you could create an endpoint that served the blog page above:</p> <div class=""><pre class=language-javascript><code><span class=hljs-comment>// routes/blog/[slug].json.js</span>
<span class=hljs-keyword>import</span> db <span class=hljs-keyword>from</span> <span class=hljs-string>'./_database.js'</span>; <span class=hljs-comment>// the underscore tells Sapper this isn't a route</span>

<span class=hljs-keyword>export</span> <span class=hljs-keyword>async</span> <span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>get</span>(<span class=hljs-params>req, res, next</span>) </span>{
	<span class=hljs-comment>// the `slug` parameter is available because this file</span>
	<span class=hljs-comment>// is called [slug].json.js</span>
	<span class=hljs-keyword>const</span> { slug } = req.params;

	<span class=hljs-keyword>const</span> article = <span class=hljs-keyword>await</span> db.get(slug);

	<span class=hljs-keyword>if</span> (article !== <span class=hljs-literal>null</span>) {
		res.setHeader(<span class=hljs-string>'Content-Type'</span>, <span class=hljs-string>'application/json'</span>);
		res.end(<span class=hljs-built_in>JSON</span>.stringify(article));
	} <span class=hljs-keyword>else</span> {
		next();
	}
}</code></pre></div><blockquote> <p><code>delete</code> is a reserved word in JavaScript. To handle DELETE requests, export a function called <code>del</code> instead.</p> </blockquote> <h3> <span class=offset-anchor id=File_naming_rules></span> <a href=docs#File_naming_rules class=anchor aria-hidden=true></a> File naming rules </h3><p>There are three simple rules for naming the files that define your routes:</p> <ul> <li>A file called <code>src/routes/about.svelte</code> corresponds to the <code>/about</code> route. A file called <code>src/routes/blog/[slug].svelte</code> corresponds to the <code>/blog/:slug</code> route, in which case <code>params.slug</code> is available to <code>preload</code></li> <li>The file <code>src/routes/index.svelte</code> corresponds to the root of your app. <code>src/routes/about/index.svelte</code> is treated the same as <code>src/routes/about.svelte</code>.</li> <li>Files and directories with a leading underscore do <em>not</em> create routes. This allows you to colocate helper modules and components with the routes that depend on them — for example you could have a file called <code>src/routes/_helpers/datetime.js</code> and it would <em>not</em> create a <code>/_helpers/datetime</code> route</li> </ul> <h3> <span class=offset-anchor id=Error_page></span> <a href=docs#Error_page class=anchor aria-hidden=true></a> Error page </h3><p>In addition to regular pages, there is a 'special' page that Sapper expects to find — <code>src/routes/_error.svelte</code>. This will be shown when an error occurs while rendering a page.</p> <p>The <code>error</code> object is made available to the template along with the HTTP <code>status</code> code.</p> <h3> <span class=offset-anchor id=Regexes_in_routes></span> <a href=docs#Regexes_in_routes class=anchor aria-hidden=true></a> Regexes in routes </h3><p>You can use a subset of regular expressions to qualify route parameters, by placing them in parentheses after the parameter name.</p> <p>For example, <code>src/routes/items/[id([0-9]+)].svelte</code> would only match numeric IDs — <code>/items/123</code> would match and make the value <code>123</code> available in <code>page.params.id</code>, but <code>/items/xyz</code> would not match.</p> <p>Because of technical limitations, the following characters cannot be used: <code>/</code>, <code>\</code>, <code>?</code>, <code>:</code>, <code>(</code> and <code>)</code>.</p> </section><section class=svelte-a3bmb2 data-id=Client_API><h2 class=svelte-a3bmb2><span class=offset-anchor id=Client_API></span> <a href=docs#Client_API class=anchor aria-hidden></a> Client API <small class=svelte-a3bmb2><a href=https://github.com/sveltejs/sapper/edit/master/site/content/docs/03-client-api.md class=svelte-a3bmb2 title="edit this section"> <svg class="icon svelte-5yec89" height=20 width=20><use xlink:href=#edit></use></svg></a> </small></h2> <p>The <code>@sapper/app</code> module, which is generated by Sapper based on the shape of your app, contains functions for controlling Sapper programmatically and responding to events.</p> <h3> <span class=offset-anchor id=start_target></span> <a href=docs#start_target class=anchor aria-hidden=true></a> start({ target }) </h3><ul> <li><code>target</code> — an element to render pages to</li> </ul> <p>This configures the router and starts the application — listens for clicks on <code>&lt;a></code> elements, interacts with the <code>history</code> API, and renders and updates your Svelte components.</p> <p>Returns a <code>Promise</code> that resolves when the initial page has been hydrated.</p> <div class=""><pre class=language-javascript><code><span class=hljs-keyword>import</span> * <span class=hljs-keyword>as</span> sapper <span class=hljs-keyword>from</span> <span class=hljs-string>'@sapper/app'</span>;

sapper.start({
	<span class=hljs-attr>target</span>: <span class=hljs-built_in>document</span>.querySelector(<span class=hljs-string>'#sapper'</span>)
}).then(<span class=hljs-function><span class=hljs-params>()</span> =></span> {
	<span class=hljs-built_in>console</span>.log(<span class=hljs-string>'client-side app has started'</span>);
});</code></pre></div> <h3> <span class=offset-anchor id=goto_href_options></span> <a href=docs#goto_href_options class=anchor aria-hidden=true></a> goto(href, options?) </h3><ul> <li><code>href</code> — the page to go to</li> <li><code>options</code> — can include a <code>replaceState</code> property, which determines whether to use <code>history.pushState</code> (the default) or <code>history.replaceState</code>. Not required</li> </ul> <p>Programmatically navigates to the given <code>href</code>. If the destination is a Sapper route, Sapper will handle the navigation, otherwise the page will be reloaded with the new <code>href</code>. In other words, the behaviour is as though the user clicked on a link with this <code>href</code>.</p> <p>Returns a <code>Promise</code> that resolves when the navigation is complete. This can be used to perform actions once the navigation has completed, such as updating a database, store, etc.</p> <div class=""><pre class=language-javascript><code><span class=hljs-keyword>import</span> { goto } <span class=hljs-keyword>from</span> <span class=hljs-string>'@sapper/app'</span>;

<span class=hljs-keyword>const</span> navigateAndSave = <span class=hljs-keyword>async</span> () => {
	<span class=hljs-keyword>await</span> goto(<span class=hljs-string>'/'</span>);
	saveItem();
}

<span class=hljs-keyword>const</span> saveItem = <span class=hljs-function><span class=hljs-params>()</span> =></span> {
	<span class=hljs-comment>// do something with the database</span>
}</code></pre></div> <h3> <span class=offset-anchor id=prefetch_href></span> <a href=docs#prefetch_href class=anchor aria-hidden=true></a> prefetch(href) </h3><ul> <li><code>href</code> — the page to prefetch</li> </ul> <p>Programmatically prefetches the given page, which means a) ensuring that the code for the page is loaded, and b) calling the page's <code>preload</code> method with the appropriate options. This is the same behaviour that Sapper triggers when the user taps or mouses over an <code>&lt;a></code> element with <a href=docs#rel_prefetch rel="noopener noreferrer">rel=prefetch</a>.</p> <p>Returns a <code>Promise</code> that resolves when the prefetch is complete.</p> <h3> <span class=offset-anchor id=prefetchRoutes_routes></span> <a href=docs#prefetchRoutes_routes class=anchor aria-hidden=true></a> prefetchRoutes(routes?) </h3><ul> <li><code>routes</code> — an optional array of strings representing routes to prefetch</li> </ul> <p>Programmatically prefetches the code for routes that haven't yet been fetched. Typically, you might call this after <code>sapper.start()</code> is complete, to speed up subsequent navigation (this is the 'L' of the <a href=https://developers.google.com/web/fundamentals/performance/prpl-pattern/ rel="noopener noreferrer" target=_blank>PRPL pattern</a>). Omitting arguments will cause all routes to be fetched, or you can specify routes by any matching pathname such as <code>/about</code> (to match <code>src/routes/about.svelte</code>) or <code>/blog/*</code> (to match <code>src/routes/blog/[slug].svelte</code>). Unlike <code>prefetch</code>, this won't call <code>preload</code> for individual pages.</p> <p>Returns a <code>Promise</code> that resolves when the routes have been prefetched.</p> </section><section class=svelte-a3bmb2 data-id=Preloading><h2 class=svelte-a3bmb2><span class=offset-anchor id=Preloading></span> <a href=docs#Preloading class=anchor aria-hidden></a> Preloading <small class=svelte-a3bmb2><a href=https://github.com/sveltejs/sapper/edit/master/site/content/docs/04-preloading.md class=svelte-a3bmb2 title="edit this section"> <svg class="icon svelte-5yec89" height=20 width=20><use xlink:href=#edit></use></svg></a> </small></h2> <p>As seen in the <a href=docs#Routing rel="noopener noreferrer">routing</a> section, page components can have an optional <code>preload</code> function that will load some data that the page depends on. This is similar to <code>getInitialProps</code> in Next.js or <code>asyncData</code> in Nuxt.js.</p> <div class=""><pre class=language-markup><code><span class=hljs-tag>&lt;<span class=hljs-name>script</span> <span class=hljs-attr>context</span>=<span class=hljs-string>"module"</span>></span><span class=javascript>
	<span class=hljs-keyword>export</span> <span class=hljs-keyword>async</span> <span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>preload</span>(<span class=hljs-params>page, session</span>) </span>{
		<span class=hljs-keyword>const</span> { slug } = page.params;

		<span class=hljs-keyword>const</span> res = <span class=hljs-keyword>await</span> <span class=hljs-keyword>this</span>.fetch(<span class=hljs-string>`blog/<span class=hljs-subst>${slug}</span>.json`</span>);
		<span class=hljs-keyword>const</span> article = <span class=hljs-keyword>await</span> res.json();

		<span class=hljs-keyword>return</span> { article };
	}
</span><span class=hljs-tag>&lt;/<span class=hljs-name>script</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>script</span>></span><span class=javascript>
	<span class=hljs-keyword>export</span> <span class=hljs-keyword>let</span> article;
</span><span class=hljs-tag>&lt;/<span class=hljs-name>script</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>h1</span>></span>{article.title}<span class=hljs-tag>&lt;/<span class=hljs-name>h1</span>></span>
</code></pre></div><p>It lives in a <code>context="module"</code> script — see the <a href=https://svelte.dev/tutorial/module-exports rel="noopener noreferrer" target=_blank>tutorial</a> — because it's not part of the component instance itself; instead, it runs <em>before</em> the component is created, allowing you to avoid flashes while data is fetched.</p> <h3> <span class=offset-anchor id=Arguments></span> <a href=docs#Arguments class=anchor aria-hidden=true></a> Arguments </h3><p>The <code>preload</code> function receives two arguments — <code>page</code> and <code>session</code>.</p> <p><code>page</code> is a <code>{ host, path, params, query }</code> object where <code>host</code> is the URL's host, <code>path</code> is its pathname, <code>params</code> is derived from <code>path</code> and the route filename, and <code>query</code> is an object of values in the query string.</p> <p>So if the example above was <code>src/routes/blog/[slug].svelte</code> and the URL was <code>/blog/some-post?foo=bar&baz</code>, the following would be true:</p> <ul> <li><code>page.path === '/blog/some-post'</code></li> <li><code>page.params.slug === 'some-post'</code></li> <li><code>page.query.foo === 'bar'</code></li> <li><code>page.query.baz === true</code></li> </ul> <p><code>session</code> is generated on the server by the <code>session</code> option passed to <code>sapper.middleware</code>. For example:</p> <div class=""><pre class=language-javascript><code>sapper.middleware({
	<span class=hljs-attr>session</span>: <span class=hljs-function>(<span class=hljs-params>req, res</span>) =></span> ({
		<span class=hljs-attr>user</span>: req.user
	})
})</code></pre></div> <h3> <span class=offset-anchor id=Return_value></span> <a href=docs#Return_value class=anchor aria-hidden=true></a> Return value </h3><p>If you return a Promise from <code>preload</code>, the page will delay rendering until the promise resolves. You can also return a plain object. In both cases, the values in the object will be passed into the components as props.</p> <p>When Sapper renders a page on the server, it will attempt to serialize the resolved value (using <a href=https://github.com/Rich-Harris/devalue rel="noopener noreferrer" target=_blank>devalue</a>) and include it on the page, so that the client doesn't also need to call <code>preload</code> upon initialization. Serialization will fail if the value includes functions or custom classes (cyclical and repeated references are fine, as are built-ins like <code>Date</code>, <code>Map</code>, <code>Set</code> and <code>RegExp</code>).</p> <h3> <span class=offset-anchor id=Context></span> <a href=docs#Context class=anchor aria-hidden=true></a> Context </h3><p>Inside <code>preload</code>, you have access to three methods:</p> <ul> <li><code>this.fetch(url, options)</code></li> <li><code>this.error(statusCode, error)</code></li> <li><code>this.redirect(statusCode, location)</code></li> </ul> <h4> <span class=offset-anchor id=this_fetch></span> <a href=docs#this_fetch class=anchor aria-hidden=true></a> this.fetch </h4><p>In browsers, you can use <code>fetch</code> to make AJAX requests, for getting data from your server routes (among other things). On the server it's a little trickier — you can make HTTP requests, but you must specify an origin, and you don't have access to cookies. This means that it's impossible to request data based on the user's session, such as data that requires you to be logged in.</p> <p>To fix this, Sapper provides <code>this.fetch</code>, which works on the server as well as in the client:</p> <div class=""><pre class=language-markup><code><span class=hljs-tag>&lt;<span class=hljs-name>script</span> <span class=hljs-attr>context</span>=<span class=hljs-string>"module"</span>></span><span class=javascript>
	<span class=hljs-keyword>export</span> <span class=hljs-keyword>async</span> <span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>preload</span>(<span class=hljs-params></span>) </span>{
		<span class=hljs-keyword>const</span> res = <span class=hljs-keyword>await</span> <span class=hljs-keyword>this</span>.fetch(<span class=hljs-string>`secret-data.json`</span>, {
			<span class=hljs-attr>credentials</span>: <span class=hljs-string>'include'</span>
		});

		<span class=hljs-comment>// ...</span>
	}
</span><span class=hljs-tag>&lt;/<span class=hljs-name>script</span>></span></code></pre></div><p>It is important to note that <code>preload</code> may run on either the server or in the client browser. Code called inside <code>preload</code> blocks:</p> <ul> <li>should run on the same domain as any upstream API servers requiring credentials; otherwise, <code>credentials: 'include'</code> cannot guarantee access to 3rd party session cookies</li> <li>should not reference <code>window</code>, <code>document</code> or any browser-specific objects</li> <li>should not reference any API keys or secrets, which will be exposed to the client</li> </ul> <p>If you are using Sapper as an authentication/authorization server, you can use session middleware such as <a href=https://github.com/expressjs/session rel="noopener noreferrer" target=_blank>express-session</a> in your <code>app/server.js</code> in order to maintain user sessions.</p> <h4> <span class=offset-anchor id=this_error></span> <a href=docs#this_error class=anchor aria-hidden=true></a> this.error </h4><p>If the user navigated to <code>/blog/some-invalid-slug</code>, we would want to render a 404 Not Found page. We can do that with <code>this.error</code>:</p> <div class=""><pre class=language-markup><code><span class=hljs-tag>&lt;<span class=hljs-name>script</span> <span class=hljs-attr>context</span>=<span class=hljs-string>"module"</span>></span><span class=javascript>
	<span class=hljs-keyword>export</span> <span class=hljs-keyword>async</span> <span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>preload</span>(<span class=hljs-params>{ params, query }</span>) </span>{
		<span class=hljs-keyword>const</span> { slug } = params;

		<span class=hljs-keyword>const</span> res = <span class=hljs-keyword>await</span> <span class=hljs-keyword>this</span>.fetch(<span class=hljs-string>`blog/<span class=hljs-subst>${slug}</span>.json`</span>);

		<span class=hljs-keyword>if</span> (res.status === <span class=hljs-number>200</span>) {
			<span class=hljs-keyword>const</span> article = <span class=hljs-keyword>await</span> res.json();
			<span class=hljs-keyword>return</span> { article };
		}

		<span class=hljs-keyword>this</span>.error(<span class=hljs-number>404</span>, <span class=hljs-string>'Not found'</span>);
	}
</span><span class=hljs-tag>&lt;/<span class=hljs-name>script</span>></span></code></pre></div><p>The same applies to other error codes you might encounter.</p> <h4> <span class=offset-anchor id=this_redirect></span> <a href=docs#this_redirect class=anchor aria-hidden=true></a> this.redirect </h4><p>You can abort rendering and redirect to a different location with <code>this.redirect</code>:</p> <div class=""><pre class=language-markup><code><span class=hljs-tag>&lt;<span class=hljs-name>script</span> <span class=hljs-attr>context</span>=<span class=hljs-string>"module"</span>></span><span class=javascript>
	<span class=hljs-keyword>export</span> <span class=hljs-keyword>async</span> <span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>preload</span>(<span class=hljs-params>page, session</span>) </span>{
		<span class=hljs-keyword>const</span> { user } = session;

		<span class=hljs-keyword>if</span> (!user) {
			<span class=hljs-keyword>return</span> <span class=hljs-keyword>this</span>.redirect(<span class=hljs-number>302</span>, <span class=hljs-string>'login'</span>);
		}

		<span class=hljs-keyword>return</span> { user };
	}
</span><span class=hljs-tag>&lt;/<span class=hljs-name>script</span>></span></code></pre></div> </section><section class=svelte-a3bmb2 data-id=Layouts><h2 class=svelte-a3bmb2><span class=offset-anchor id=Layouts></span> <a href=docs#Layouts class=anchor aria-hidden></a> Layouts <small class=svelte-a3bmb2><a href=https://github.com/sveltejs/sapper/edit/master/site/content/docs/05-layouts.md class=svelte-a3bmb2 title="edit this section"> <svg class="icon svelte-5yec89" height=20 width=20><use xlink:href=#edit></use></svg></a> </small></h2> <p>So far, we've treated pages as entirely standalone components — upon navigation, the existing component will be destroyed, and a new one will take its place.</p> <p>But in many apps, there are elements that should be visible on <em>every</em> page, such as top-level navigation or a footer. Instead of repeating them in every page, we can use <em>layout</em> components.</p> <p>To create a layout component that applies to every page, make a file called <code>src/routes/_layout.svelte</code>. The default layout component (the one that Sapper uses if you don't bring your own) looks like this...</p> <div class=""><pre class=language-markup><code><span class=hljs-tag>&lt;<span class=hljs-name>slot</span>></span><span class=hljs-tag>&lt;/<span class=hljs-name>slot</span>></span></code></pre></div><p>...but we can add whatever markup, styles and behaviour we want. For example, let's add a nav bar:</p> <div class=""><pre class=language-markup><code><span class=hljs-comment>&lt;!-- src/routes/_layout.svelte --></span>
<span class=hljs-tag>&lt;<span class=hljs-name>nav</span>></span>
	<span class=hljs-tag>&lt;<span class=hljs-name>a</span> <span class=hljs-attr>href</span>=<span class=hljs-string>"."</span>></span>Home<span class=hljs-tag>&lt;/<span class=hljs-name>a</span>></span>
	<span class=hljs-tag>&lt;<span class=hljs-name>a</span> <span class=hljs-attr>href</span>=<span class=hljs-string>"about"</span>></span>About<span class=hljs-tag>&lt;/<span class=hljs-name>a</span>></span>
	<span class=hljs-tag>&lt;<span class=hljs-name>a</span> <span class=hljs-attr>href</span>=<span class=hljs-string>"settings"</span>></span>Settings<span class=hljs-tag>&lt;/<span class=hljs-name>a</span>></span>
<span class=hljs-tag>&lt;/<span class=hljs-name>nav</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>slot</span>></span><span class=hljs-tag>&lt;/<span class=hljs-name>slot</span>></span></code></pre></div><p>If we create pages for <code>/</code>, <code>/about</code> and <code>/settings</code>...</p> <div class=""><pre class=language-markup><code><span class=hljs-comment>&lt;!-- src/routes/index.svelte --></span>
<span class=hljs-tag>&lt;<span class=hljs-name>h1</span>></span>Home<span class=hljs-tag>&lt;/<span class=hljs-name>h1</span>></span></code></pre></div><div class=""><pre class=language-markup><code><span class=hljs-comment>&lt;!-- src/routes/about.svelte --></span>
<span class=hljs-tag>&lt;<span class=hljs-name>h1</span>></span>About<span class=hljs-tag>&lt;/<span class=hljs-name>h1</span>></span></code></pre></div><div class=""><pre class=language-markup><code><span class=hljs-comment>&lt;!-- src/routes/settings.svelte --></span>
<span class=hljs-tag>&lt;<span class=hljs-name>h1</span>></span>Settings<span class=hljs-tag>&lt;/<span class=hljs-name>h1</span>></span></code></pre></div><p>...the nav will always be visible, and clicking between the three pages will only result in the <code>&lt;h1></code> being replaced.</p> <h3> <span class=offset-anchor id=Nested_routes></span> <a href=docs#Nested_routes class=anchor aria-hidden=true></a> Nested routes </h3><p>Suppose we don't just have a single <code>/settings</code> page, but instead have nested pages like <code>/settings/profile</code> and <code>/settings/notifications</code> with a shared submenu (for a real-life example, see <a href=https://github.com/settings rel="noopener noreferrer" target=_blank>github.com/settings</a>).</p> <p>We can create a layout that only applies to pages below <code>/settings</code> (while inheriting the root layout with the top-level nav):</p> <div class=""><pre class=language-markup><code><span class=hljs-comment>&lt;!-- src/routes/settings/_layout.svelte --></span>
<span class=hljs-tag>&lt;<span class=hljs-name>h1</span>></span>Settings<span class=hljs-tag>&lt;/<span class=hljs-name>h1</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>div</span> <span class=hljs-attr>class</span>=<span class=hljs-string>"submenu"</span>></span>
	<span class=hljs-tag>&lt;<span class=hljs-name>a</span> <span class=hljs-attr>href</span>=<span class=hljs-string>"settings/profile"</span>></span>Profile<span class=hljs-tag>&lt;/<span class=hljs-name>a</span>></span>
	<span class=hljs-tag>&lt;<span class=hljs-name>a</span> <span class=hljs-attr>href</span>=<span class=hljs-string>"settings/notifications"</span>></span>Notifications<span class=hljs-tag>&lt;/<span class=hljs-name>a</span>></span>
<span class=hljs-tag>&lt;/<span class=hljs-name>div</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>slot</span>></span><span class=hljs-tag>&lt;/<span class=hljs-name>slot</span>></span></code></pre></div><p>Layout components receive a <code>segment</code> property which is useful for things like styling:</p> <div class=""><pre class=language-diff><code><span class=hljs-addition>+&lt;script></span>
<span class=hljs-addition>+    export let segment;</span>
<span class=hljs-addition>+&lt;/script></span>
<span class=hljs-addition>+</span>
&lt;div class="submenu">
<span class=hljs-deletion>-    &lt;a href="settings/profile">Profile&lt;/a></span>
<span class=hljs-deletion>-    &lt;a href="settings/notifications">Notifications&lt;/a></span>
<span class=hljs-addition>+    &lt;a</span>
<span class=hljs-addition>+        class:selected={segment === "profile"}</span>
<span class=hljs-addition>+        href="settings/profile"</span>
<span class=hljs-addition>+    >Profile&lt;/a></span>
<span class=hljs-addition>+</span>
<span class=hljs-addition>+    &lt;a</span>
<span class=hljs-addition>+        class:selected={segment === "notifications"}</span>
<span class=hljs-addition>+        href="settings/notifications"</span>
<span class=hljs-addition>+    >Notifications&lt;/a></span>
&lt;/div></code></pre></div> </section><section class=svelte-a3bmb2 data-id=Server-side_rendering><h2 class=svelte-a3bmb2><span class=offset-anchor id=Server-side_rendering></span> <a href=docs#Server-side_rendering class=anchor aria-hidden></a> Server-side rendering <small class=svelte-a3bmb2><a href=https://github.com/sveltejs/sapper/edit/master/site/content/docs/06-server-side-rendering.md class=svelte-a3bmb2 title="edit this section"> <svg class="icon svelte-5yec89" height=20 width=20><use xlink:href=#edit></use></svg></a> </small></h2> <p>Sapper, by default, renders server-side first (SSR), and then re-mounts any dynamic elements on the client. Svelte provides <a href=https://svelte.dev/docs#Server-side_component_API rel="noopener noreferrer" target=_blank>excellent support for this</a>. This has benefits in performance and search engine indexing, among others, but comes with its own set of complexities.</p> <h3> <span class=offset-anchor id=Making_a_component_SSR_compatible></span> <a href=docs#Making_a_component_SSR_compatible class=anchor aria-hidden=true></a> Making a component SSR compatible </h3><p>Sapper works well with most third-party libraries you are likely to come across. However, sometimes, a third-party library comes bundled in a way which allows it to work with multiple different module loaders. Sometimes, this code creates a dependency on <code>window</code>, such as checking for the existence of <code>window.global</code> might do.</p> <p>Since there is no <code>window</code> in a server-side environment like Sapper's, the action of simply importing such a module can cause the import to fail, and terminate the Sapper's server with an error such as:</p> <div class=""><pre class=language-bash><code>ReferenceError: window is not defined</code></pre></div><p>The way to get around this is to use a dynamic import for your component, from within the <code>onMount</code> function (which is only called on the client), so that your import code is never called on the server.</p> <div class=""><pre class=language-markup><code><span class=hljs-tag>&lt;<span class=hljs-name>script</span>></span><span class=javascript>
	<span class=hljs-keyword>import</span> { onMount } <span class=hljs-keyword>from</span> <span class=hljs-string>'svelte'</span>;

	<span class=hljs-keyword>let</span> MyComponent;

	onMount(<span class=hljs-keyword>async</span> () => {
		<span class=hljs-keyword>const</span> <span class=hljs-built_in>module</span> = <span class=hljs-keyword>await</span> <span class=hljs-keyword>import</span>(<span class=hljs-string>'my-non-ssr-component'</span>);
		MyComponent = <span class=hljs-built_in>module</span>.default;
	});
</span><span class=hljs-tag>&lt;/<span class=hljs-name>script</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>svelte:component</span> <span class=hljs-attr>this</span>=<span class=hljs-string>{MyComponent}</span> <span class=hljs-attr>foo</span>=<span class=hljs-string>"bar"</span>/></span></code></pre></div> </section><section class=svelte-a3bmb2 data-id=Stores><h2 class=svelte-a3bmb2><span class=offset-anchor id=Stores></span> <a href=docs#Stores class=anchor aria-hidden></a> Stores <small class=svelte-a3bmb2><a href=https://github.com/sveltejs/sapper/edit/master/site/content/docs/07-state-management.md class=svelte-a3bmb2 title="edit this section"> <svg class="icon svelte-5yec89" height=20 width=20><use xlink:href=#edit></use></svg></a> </small></h2> <p>The <code>page</code> and <code>session</code> values passed to <code>preload</code> functions are available to components as <a href=https://svelte.dev/tutorial/writable-stores rel="noopener noreferrer" target=_blank>stores</a>, along with <code>preloading</code>.</p> <p>Inside a component, get references to the stores like so:</p> <div class=""><pre class=language-markup><code><span class=hljs-tag>&lt;<span class=hljs-name>script</span>></span><span class=javascript>
	<span class=hljs-keyword>import</span> { stores } <span class=hljs-keyword>from</span> <span class=hljs-string>'@sapper/app'</span>;
	<span class=hljs-keyword>const</span> { preloading, page, session } = stores();
</span><span class=hljs-tag>&lt;/<span class=hljs-name>script</span>></span></code></pre></div><ul> <li><code>preloading</code> contains a readonly boolean value, indicating whether or not a navigation is pending</li> <li><code>page</code> contains a readonly <code>{ host, path, params, query }</code> object, identical to that passed to <code>preload</code> functions</li> <li><code>session</code> contains whatever data was seeded on the server. It is a <a href=https://svelte.dev/tutorial/writable-stores rel="noopener noreferrer" target=_blank>writable store</a>, meaning you can update it with new data (for example, after the user logs in) and your app will be refreshed</li> </ul> <h3> <span class=offset-anchor id=Seeding_session_data></span> <a href=docs#Seeding_session_data class=anchor aria-hidden=true></a> Seeding session data </h3><p>On the server, you can populate <code>session</code> by passing an option to <code>sapper.middleware</code>:</p> <div class=""><pre class=language-javascript><code><span class=hljs-comment>// src/server.js</span>
express() <span class=hljs-comment>// or Polka, or a similar framework</span>
	.use(
		serve(<span class=hljs-string>'static'</span>),
		authenticationMiddleware(),
		sapper.middleware({
			<span class=hljs-attr>session</span>: <span class=hljs-function>(<span class=hljs-params>req, res</span>) =></span> ({
				<span class=hljs-attr>user</span>: req.user
			})
		})
	)
	.listen(process.env.PORT);</code></pre></div><blockquote> <p>Session data must be serializable (using <a href=https://github.com/Rich-Harris/devalue rel="noopener noreferrer" target=_blank>devalue</a>) — no functions or custom classes, just built-in JavaScript data types</p> </blockquote> </section><section class=svelte-a3bmb2 data-id=Link_options><h2 class=svelte-a3bmb2><span class=offset-anchor id=Link_options></span> <a href=docs#Link_options class=anchor aria-hidden></a> Link options <small class=svelte-a3bmb2><a href=https://github.com/sveltejs/sapper/edit/master/site/content/docs/08-link-options.md class=svelte-a3bmb2 title="edit this section"> <svg class="icon svelte-5yec89" height=20 width=20><use xlink:href=#edit></use></svg></a> </small></h2> <h3> <span class=offset-anchor id=rel_prefetch></span> <a href=docs#rel_prefetch class=anchor aria-hidden=true></a> rel=prefetch </h3><p>Sapper uses code splitting to break your app into small chunks (one per route), ensuring fast startup times.</p> <p>For <em>dynamic</em> routes, such as our <code>src/routes/blog/[slug].svelte</code> example, that's not enough. In order to render the blog post, we need to fetch the data for it, and we can't do that until we know what <code>slug</code> is. In the worst case, that could cause lag as the browser waits for the data to come back from the server.</p> <p>We can mitigate that by <em>prefetching</em> the data. Adding a <code>rel=prefetch</code> attribute to a link...</p> <div class=""><pre class=language-markup><code><span class=hljs-tag>&lt;<span class=hljs-name>a</span> <span class=hljs-attr>rel</span>=<span class=hljs-string>prefetch</span> <span class=hljs-attr>href</span>=<span class=hljs-string>'blog/what-is-sapper'</span>></span>What is Sapper?<span class=hljs-tag>&lt;/<span class=hljs-name>a</span>></span></code></pre></div><p>...will cause Sapper to run the page's <code>preload</code> function as soon as the user hovers over the link (on a desktop) or touches it (on mobile), rather than waiting for the <code>click</code> event to trigger navigation. Typically, this buys us an extra couple of hundred milliseconds, which is the difference between a user interface that feels laggy, and one that feels snappy.</p> <blockquote> <p><code>rel=prefetch</code> is a Sapper idiom, not a standard attribute for <code>&lt;a></code> elements</p> </blockquote> <h3> <span class=offset-anchor id=rel_external></span> <a href=docs#rel_external class=anchor aria-hidden=true></a> rel=external </h3><p>By default, the Sapper runtime intercepts clicks on <code>&lt;a></code> elements and bypasses the normal browser navigation for relative (same-origin) URLs that match one of your page routes. We sometimes need to tell Sapper that certain links need to be be handled by normal browser navigation.</p> <p>Adding a <code>rel=external</code> attribute to a link...</p> <div class=""><pre class=language-markup><code><span class=hljs-tag>&lt;<span class=hljs-name>a</span> <span class=hljs-attr>rel</span>=<span class=hljs-string>external</span> <span class=hljs-attr>href</span>=<span class=hljs-string>'path'</span>></span>Path<span class=hljs-tag>&lt;/<span class=hljs-name>a</span>></span></code></pre></div><p>...will trigger a browser navigation when the link is clicked.</p> </section><section class=svelte-a3bmb2 data-id=Building><h2 class=svelte-a3bmb2><span class=offset-anchor id=Building></span> <a href=docs#Building class=anchor aria-hidden></a> Building <small class=svelte-a3bmb2><a href=https://github.com/sveltejs/sapper/edit/master/site/content/docs/09-building.md class=svelte-a3bmb2 title="edit this section"> <svg class="icon svelte-5yec89" height=20 width=20><use xlink:href=#edit></use></svg></a> </small></h2> <p>Up until now we've been using <code>sapper dev</code> to build our application and run a development server. But when it comes to production, we want to create a self-contained optimized build.</p> <h3> <span class=offset-anchor id=sapper_build></span> <a href=docs#sapper_build class=anchor aria-hidden=true></a> sapper build </h3><p>This command packages up your application into the <code>__sapper__/build</code> directory. (You can change this to a custom directory, as well as controlling various other options — do <code>sapper build --help</code> for more information.)</p> <p>The output is a Node app that you can run from the project root:</p> <div class=""><pre class=language-bash><code>node __sapper__/build</code></pre></div> <h3> <span class=offset-anchor id=Browser_support></span> <a href=docs#Browser_support class=anchor aria-hidden=true></a> Browser support </h3><p>Your site is built only for the latest versions of modern evergreen browsers by default. If you are using Rollup, you can use the <code>--legacy</code><sup>1</sup> flag to build a second bundle that can be used to support legacy browsers like Internet Explorer. Sapper will then serve up the correct bundle at runtime<sup>2</sup>.</p> <p>When using <code>--legacy</code>, Sapper will pass an environment variable <code>SAPPER_LEGACY_BUILD</code> to your Rollup config. Sapper will then build your client-side bundle twice: once with <code>SAPPER_LEGACY_BUILD</code> set to <code>true</code> and once with it set to <code>false</code>. <a href=https://github.com/sveltejs/sapper-template-rollup rel="noopener noreferrer" target=_blank>sapper-template-rollup</a> provides an example of utilizing this configuration.<sup>3</sup></p> <p>You may wish to add this flag to a script in your <code>package.json</code>:</p> <div class=""><pre class=language-javascript><code>  <span class=hljs-string>"scripts"</span>: {
	<span class=hljs-string>"build"</span>: <span class=hljs-string>"sapper build --legacy"</span>,
  },</code></pre></div><ol> <li>This option is unrelated to Svelte's <code>legacy</code> option</li> <li>Browsers which do not support <code>async/await</code> syntax will be served the legacy bundle</li> <li>You will also need to polyfill APIs that are not present in older browsers.</li> </ol> </section><section class=svelte-a3bmb2 data-id=Exporting><h2 class=svelte-a3bmb2><span class=offset-anchor id=Exporting></span> <a href=docs#Exporting class=anchor aria-hidden></a> Exporting <small class=svelte-a3bmb2><a href=https://github.com/sveltejs/sapper/edit/master/site/content/docs/10-exporting.md class=svelte-a3bmb2 title="edit this section"> <svg class="icon svelte-5yec89" height=20 width=20><use xlink:href=#edit></use></svg></a> </small></h2> <p>Many sites are effectively <em>static</em>, which is to say they don't actually need an Express server backing them. Instead, they can be hosted and served as static files, which allows them to be deployed to more hosting environments (such as <a href=https://www.netlify.com/ rel="noopener noreferrer" target=_blank>Netlify</a> or <a href=https://pages.github.com/ rel="noopener noreferrer" target=_blank>GitHub Pages</a>). Static sites are generally cheaper to operate and have better performance characteristics.</p> <p>Sapper allows you to <em>export</em> a static site with a single zero-config <code>sapper export</code> command. In fact, you're looking at an exported site right now!</p> <p>Static doesn't mean non-interactive — your Svelte components work exactly as they do normally, and you still get all the benefits of client-side routing and prefetching.</p> <h3> <span class=offset-anchor id=sapper_export></span> <a href=docs#sapper_export class=anchor aria-hidden=true></a> sapper export </h3><p>Inside your Sapper project, try this:</p> <div class=""><pre class=language-bash><code><span class=hljs-comment># npx allows you to use locally-installed dependencies</span>
npx sapper <span class=hljs-built_in>export</span></code></pre></div><p>This will create a <code>__sapper__/export</code> folder with a production-ready build of your site. You can launch it like so:</p> <div class=""><pre class=language-bash><code>npx serve __sapper__/<span class=hljs-built_in>export</span></code></pre></div><p>Navigate to <a href=http://localhost:5000 rel="noopener noreferrer" target=_blank>localhost:5000</a> (or whatever port <code>serve</code> picked), and verify that your site works as expected.</p> <p>You can also add a script to your package.json...</p> <div class=""><pre class=language-javascript><code>{
	<span class=hljs-string>"scripts"</span>: {
		...
		<span class=hljs-string>"export"</span>: <span class=hljs-string>"sapper export"</span>
	}
}</code></pre></div><p>...allowing you to <code>npm run export</code> your app.</p> <h3> <span class=offset-anchor id=How_it_works></span> <a href=docs#How_it_works class=anchor aria-hidden=true></a> How it works </h3><p>When you run <code>sapper export</code>, Sapper first builds a production version of your app, as though you had run <code>sapper build</code>, and copies the contents of your <code>static</code> folder to the destination. It then starts the server, and navigates to the root of your app. From there, it follows any <code>&lt;a></code> elements it finds, and captures any data served by the app.</p> <p>Because of this, any pages you want to be included in the exported site must either be reachable by <code>&lt;a></code> elements or added to the <code>--entry</code> option of the <code>sapper export</code> command.</p> <p>The <code>--entry</code> option expects a string of space-separated values. Examples:</p> <div class=""><pre class=language-bash><code>sapper <span class=hljs-built_in>export</span> --entry <span class=hljs-string>"some-page some-other-page"</span></code></pre></div><p>Setting <code>--entry</code> overwrites any defaults. If you wish to add export entrypoints <em>in addition</em> to <code>/</code> then make sure to add <code>/</code> as well or <code>sapper export</code> will not visit the index route.</p> <h3> <span class=offset-anchor id=When_not_to_export></span> <a href=docs#When_not_to_export class=anchor aria-hidden=true></a> When not to export </h3><p>The basic rule is this: for an app to be exportable, any two users hitting the same page of your app must get the same content from the server. In other words, any app that involves user sessions or authentication is <em>not</em> a candidate for <code>sapper export</code>.</p> <p>Note that you can still export apps with dynamic routes, like our <code>src/routes/blog/[slug].svelte</code> example from earlier. <code>sapper export</code> will intercept <code>fetch</code> requests made inside <code>preload</code>, so the data served from <code>src/routes/blog/[slug].json.js</code> will also be captured.</p> <h3> <span class=offset-anchor id=Route_conflicts></span> <a href=docs#Route_conflicts class=anchor aria-hidden=true></a> Route conflicts </h3><p>Because <code>sapper export</code> writes to the filesystem, it isn't possible to have two server routes that would cause a directory and a file to have the same name. For example, <code>src/routes/foo/index.js</code> and <code>src/routes/foo/bar.js</code> would try to create <code>export/foo</code> and <code>export/foo/bar</code>, which is impossible.</p> <p>The solution is to rename one of the routes to avoid conflict — for example, <code>src/routes/foo-bar.js</code>. (Note that you would also need to update any code that fetches data from <code>/foo/bar</code> to reference <code>/foo-bar</code> instead.)</p> <p>For <em>pages</em>, we skirt around this problem by writing <code>export/foo/index.html</code> instead of <code>export/foo</code>.</p> </section><section class=svelte-a3bmb2 data-id=Deployment><h2 class=svelte-a3bmb2><span class=offset-anchor id=Deployment></span> <a href=docs#Deployment class=anchor aria-hidden></a> Deployment <small class=svelte-a3bmb2><a href=https://github.com/sveltejs/sapper/edit/master/site/content/docs/11-deploying.md class=svelte-a3bmb2 title="edit this section"> <svg class="icon svelte-5yec89" height=20 width=20><use xlink:href=#edit></use></svg></a> </small></h2> <p>Sapper apps run anywhere that supports Node 8 or higher.</p> <h3> <span class=offset-anchor id=Deploying_to_Vercel></span> <a href=docs#Deploying_to_Vercel class=anchor aria-hidden=true></a> Deploying to Vercel </h3><p>We can use a third-party library like <a href=https://www.npmjs.com/package/vercel-sapper rel="noopener noreferrer" target=_blank>the <code>vercel-sapper</code> builder</a> to deploy our projects to <a href=https://vercel.com/home rel="noopener noreferrer" target=_blank>Vercel</a> (<a href=https://vercel.com/blog/zeit-is-now-vercel rel="noopener noreferrer" target=_blank>formerly ZEIT Now</a>). See <a href=https://github.com/thgh/vercel-sapper#readme rel="noopener noreferrer" target=_blank>that project's readme</a> for more details regarding <a href=https://vercel.com/home rel="noopener noreferrer" target=_blank>Vercel</a> deployments.</p> <h3> <span class=offset-anchor id=Deploying_service_workers></span> <a href=docs#Deploying_service_workers class=anchor aria-hidden=true></a> Deploying service workers </h3><p>Sapper makes the Service Worker file (<code>service-worker.js</code>) unique by including a timestamp in the source code (calculated using <code>Date.now()</code>).</p> <p>In environments where the app is deployed to multiple servers (such as <a href=https://vercel.com/home rel="noopener noreferrer" target=_blank>Vercel</a>), it is advisable to use a consistent timestamp for all deployments. Otherwise, users may run into issues where the Service Worker updates unexpectedly because the app hits server 1, then server 2, and they have slightly different timestamps.</p> <p>To override Sapper's timestamp, you can use an environment variable (e.g. <code>SAPPER_TIMESTAMP</code>) and then modify the <code>service-worker.js</code>:</p> <div class=""><pre class=language-javascript><code><span class=hljs-keyword>const</span> timestamp = process.env.SAPPER_TIMESTAMP; <span class=hljs-comment>// instead of `import { timestamp }`</span>

<span class=hljs-keyword>const</span> ASSETS = <span class=hljs-string>`cache<span class=hljs-subst>${timestamp}</span>`</span>;

<span class=hljs-keyword>export</span> <span class=hljs-keyword>default</span> {
	<span class=hljs-comment>/* ... */</span>
	<span class=hljs-attr>plugins</span>: [
		<span class=hljs-comment>/* ... */</span>
		replace({
			<span class=hljs-comment>/* ... */</span>
			<span class=hljs-string>'process.env.SAPPER_TIMESTAMP'</span>: process.env.SAPPER_TIMESTAMP || <span class=hljs-built_in>Date</span>.now()
		})
	]
}</code></pre></div><p>Then you can set it using the environment variable, e.g.:</p> <div class=""><pre class=language-bash><code>SAPPER_TIMESTAMP=$(date +%s%3N) npm run build</code></pre></div><p>When deploying to <a href=https://vercel.com/home rel="noopener noreferrer" target=_blank>Vercel</a>, you can pass the environment variable into the Vercel CLI tool itself:</p> <div class=""><pre class=language-bash><code>vercel -e SAPPER_TIMESTAMP=$(date +%s%3N)</code></pre></div> </section><section class=svelte-a3bmb2 data-id=Security><h2 class=svelte-a3bmb2><span class=offset-anchor id=Security></span> <a href=docs#Security class=anchor aria-hidden></a> Security <small class=svelte-a3bmb2><a href=https://github.com/sveltejs/sapper/edit/master/site/content/docs/12-security.md class=svelte-a3bmb2 title="edit this section"> <svg class="icon svelte-5yec89" height=20 width=20><use xlink:href=#edit></use></svg></a> </small></h2> <p>By default, Sapper does not add security headers to your app, but you may add them yourself using middleware such as <a href=https://helmetjs.github.io/ rel="noopener noreferrer" target=_blank>Helmet</a>.</p> <h3> <span class=offset-anchor id=Content_Security_Policy_CSP></span> <a href=docs#Content_Security_Policy_CSP class=anchor aria-hidden=true></a> Content Security Policy (CSP) </h3><p>Sapper generates inline <code>&lt;script></code>s, which can fail to execute if <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP rel="noopener noreferrer" target=_blank>Content Security Policy (CSP)</a> headers disallow arbitrary script execution (<code>unsafe-inline</code>).</p> <p>To work around this, Sapper can inject a <a href=https://www.troyhunt.com/locking-down-your-website-scripts-with-csp-hashes-nonces-and-report-uri/ rel="noopener noreferrer" target=_blank>nonce</a> which can be configured with middleware to emit the proper CSP headers. Here is an example using <a href=https://expressjs.com/ rel="noopener noreferrer" target=_blank>Express</a> and <a href=https://helmetjs.github.io/ rel="noopener noreferrer" target=_blank>Helmet</a>:</p> <div class=""><pre class=language-javascript><code><span class=hljs-comment>// server.js</span>
<span class=hljs-keyword>import</span> uuidv4 <span class=hljs-keyword>from</span> <span class=hljs-string>'uuid/v4'</span>;
<span class=hljs-keyword>import</span> helmet <span class=hljs-keyword>from</span> <span class=hljs-string>'helmet'</span>;

app.use(<span class=hljs-function>(<span class=hljs-params>req, res, next</span>) =></span> {
	res.locals.nonce = uuidv4();
	next();
});
app.use(helmet({
	<span class=hljs-attr>contentSecurityPolicy</span>: {
		<span class=hljs-attr>directives</span>: {
			<span class=hljs-attr>scriptSrc</span>: [
				<span class=hljs-string>"'self'"</span>,
				(req, res) => <span class=hljs-string>`'nonce-<span class=hljs-subst>${res.locals.nonce}</span>'`</span>
			]
		}
	}
}));
app.use(sapper.middleware());</code></pre></div><p>Using <code>res.locals.nonce</code> in this way follows the convention set by <a href=https://helmetjs.github.io/docs/csp/#generating-nonces rel="noopener noreferrer" target=_blank>Helmet's CSP docs</a>.</p> </section><section class=svelte-a3bmb2 data-id=Base_URLs><h2 class=svelte-a3bmb2><span class=offset-anchor id=Base_URLs></span> <a href=docs#Base_URLs class=anchor aria-hidden></a> Base URLs <small class=svelte-a3bmb2><a href=https://github.com/sveltejs/sapper/edit/master/site/content/docs/13-base-urls.md class=svelte-a3bmb2 title="edit this section"> <svg class="icon svelte-5yec89" height=20 width=20><use xlink:href=#edit></use></svg></a> </small></h2> <p>Ordinarily, the root of your Sapper app is served at <code>/</code>. But in some cases, your app may need to be served from a different base path — for example, if Sapper only controls part of your domain, or if you have multiple Sapper apps living side-by-side.</p> <p>This can be done like so:</p> <div class=""><pre class=language-javascript><code><span class=hljs-comment>// app/server.js</span>

express() <span class=hljs-comment>// or Polka, or a similar framework</span>
	.use(
		<span class=hljs-string>'/my-base-path'</span>, <span class=hljs-comment>// &lt;!-- add this line</span>
		compression({ <span class=hljs-attr>threshold</span>: <span class=hljs-number>0</span> }),
		serve(<span class=hljs-string>'static'</span>),
		sapper.middleware()
	)
	.listen(process.env.PORT);</code></pre></div><p>Sapper will detect the base path and configure both the server-side and client-side routers accordingly.</p> <p>If you're <a href=docs#Exporting rel="noopener noreferrer">exporting</a> your app, you will need to tell the exporter where to begin crawling:</p> <div class=""><pre class=language-bash><code>sapper <span class=hljs-built_in>export</span> --basepath my-base-path</code></pre></div> </section><section class=svelte-a3bmb2 data-id=Testing><h2 class=svelte-a3bmb2><span class=offset-anchor id=Testing></span> <a href=docs#Testing class=anchor aria-hidden></a> Testing <small class=svelte-a3bmb2><a href=https://github.com/sveltejs/sapper/edit/master/site/content/docs/14-testing.md class=svelte-a3bmb2 title="edit this section"> <svg class="icon svelte-5yec89" height=20 width=20><use xlink:href=#edit></use></svg></a> </small></h2> <p>You can use whatever testing frameworks and libraries you'd like. The default in <a href=https://github.com/sveltejs/sapper-template rel="noopener noreferrer" target=_blank>sapper-template</a> is <a href=https://cypress.io rel="noopener noreferrer" target=_blank>Cypress</a>.</p> <h3> <span class=offset-anchor id=Running_the_tests></span> <a href=docs#Running_the_tests class=anchor aria-hidden=true></a> Running the tests </h3><div class=""><pre class=language-bash><code>npm <span class=hljs-built_in>test</span></code></pre></div><p>This will start the server and open Cypress. You can (and should!) add your own tests in <code>cypress/integration/spec.js</code> — consult the <a href=https://docs.cypress.io/guides/overview/why-cypress.html rel="noopener noreferrer" target=_blank>docs</a> for more information.</p> </section><section class=svelte-a3bmb2 data-id=Debugging><h2 class=svelte-a3bmb2><span class=offset-anchor id=Debugging></span> <a href=docs#Debugging class=anchor aria-hidden></a> Debugging <small class=svelte-a3bmb2><a href=https://github.com/sveltejs/sapper/edit/master/site/content/docs/15-debugging.md class=svelte-a3bmb2 title="edit this section"> <svg class="icon svelte-5yec89" height=20 width=20><use xlink:href=#edit></use></svg></a> </small></h2> <p>Debugging your server code is particularly easy with <a href=https://github.com/GoogleChromeLabs/ndb rel="noopener noreferrer" target=_blank>ndb</a>. Install it globally...</p> <div class=""><pre class=language-bash><code>npm install -g ndb</code></pre></div><p>...then run Sapper:</p> <div class=""><pre class=language-bash><code>ndb npm run dev</code></pre></div><blockquote> <p>This assumes that <code>npm run dev</code> runs <code>sapper dev</code>. You can also run Sapper via <a href=https://blog.npmjs.org/post/162869356040/introducing-npx-an-npm-package-runner rel="noopener noreferrer" target=_blank>npx</a>, as in <code>ndb npx sapper dev</code>.</p> </blockquote> <p>Note that you may not see any terminal output for a few seconds while ndb starts up.</p> </section></div> <aside class="svelte-a3bmb2 sidebar-container"><div class="svelte-a3bmb2 sidebar"> <ul class="svelte-mm3tjv reference-toc"><li class=svelte-mm3tjv><a href=docs#Introduction class="svelte-mm3tjv section">Introduction </a> <a href=docs#Before_we_begin class="svelte-mm3tjv subsection" data-level=3>Before we begin </a> <a href=docs#What_is_Sapper class="svelte-mm3tjv subsection" data-level=3>What is Sapper? </a> <a href=docs#Why_the_name class="svelte-mm3tjv subsection" data-level=3>Why the name? </a> <a href=docs#Comparison_with_Next_js class="svelte-mm3tjv subsection" data-level=3>Comparison with Next.js </a> <a href=docs#Getting_started class="svelte-mm3tjv subsection" data-level=3>Getting started </a> <li class=svelte-mm3tjv><a href=docs#Sapper_app_structure class="svelte-mm3tjv section">Sapper app structure </a> <a href=docs#package_json class="svelte-mm3tjv subsection" data-level=3>package.json </a> <a href=docs#src class="svelte-mm3tjv subsection" data-level=3>src </a> <a href=docs#src_client_js class="svelte-mm3tjv subsection" data-level=4>src/client.js </a> <a href=docs#src_server_js class="svelte-mm3tjv subsection" data-level=4>src/server.js </a> <a href=docs#src_service-worker_js class="svelte-mm3tjv subsection" data-level=4>src/service-worker.js </a> <a href=docs#src_template_html class="svelte-mm3tjv subsection" data-level=4>src/template.html </a> <a href=docs#src_routes class="svelte-mm3tjv subsection" data-level=3>src/routes </a> <a href=docs#static class="svelte-mm3tjv subsection" data-level=3>static </a> <a href=docs#rollup_config_js_webpack_config_js class="svelte-mm3tjv subsection" data-level=3>rollup.config.js / webpack.config.js </a> <li class=svelte-mm3tjv><a href=docs#Routing class="svelte-mm3tjv section">Routing </a> <a href=docs#Pages class="svelte-mm3tjv subsection" data-level=3>Pages </a> <a href=docs#Server_routes class="svelte-mm3tjv subsection" data-level=3>Server routes </a> <a href=docs#File_naming_rules class="svelte-mm3tjv subsection" data-level=3>File naming rules </a> <a href=docs#Error_page class="svelte-mm3tjv subsection" data-level=3>Error page </a> <a href=docs#Regexes_in_routes class="svelte-mm3tjv subsection" data-level=3>Regexes in routes </a> <li class=svelte-mm3tjv><a href=docs#Client_API class="svelte-mm3tjv section">Client API </a> <a href=docs#start_target class="svelte-mm3tjv subsection" data-level=3>start({ target }) </a> <a href=docs#goto_href_options class="svelte-mm3tjv subsection" data-level=3>goto(href, options?) </a> <a href=docs#prefetch_href class="svelte-mm3tjv subsection" data-level=3>prefetch(href) </a> <a href=docs#prefetchRoutes_routes class="svelte-mm3tjv subsection" data-level=3>prefetchRoutes(routes?) </a> <li class=svelte-mm3tjv><a href=docs#Preloading class="svelte-mm3tjv section">Preloading </a> <a href=docs#Arguments class="svelte-mm3tjv subsection" data-level=3>Arguments </a> <a href=docs#Return_value class="svelte-mm3tjv subsection" data-level=3>Return value </a> <a href=docs#Context class="svelte-mm3tjv subsection" data-level=3>Context </a> <a href=docs#this_fetch class="svelte-mm3tjv subsection" data-level=4>this.fetch </a> <a href=docs#this_error class="svelte-mm3tjv subsection" data-level=4>this.error </a> <a href=docs#this_redirect class="svelte-mm3tjv subsection" data-level=4>this.redirect </a> <li class=svelte-mm3tjv><a href=docs#Layouts class="svelte-mm3tjv section">Layouts </a> <a href=docs#Nested_routes class="svelte-mm3tjv subsection" data-level=3>Nested routes </a> <li class=svelte-mm3tjv><a href=docs#Server-side_rendering class="svelte-mm3tjv section">Server-side rendering </a> <a href=docs#Making_a_component_SSR_compatible class="svelte-mm3tjv subsection" data-level=3>Making a component SSR compatible </a> <li class=svelte-mm3tjv><a href=docs#Stores class="svelte-mm3tjv section">Stores </a> <a href=docs#Seeding_session_data class="svelte-mm3tjv subsection" data-level=3>Seeding session data </a> <li class=svelte-mm3tjv><a href=docs#Link_options class="svelte-mm3tjv section">Link options </a> <a href=docs#rel_prefetch class="svelte-mm3tjv subsection" data-level=3>rel=prefetch </a> <a href=docs#rel_external class="svelte-mm3tjv subsection" data-level=3>rel=external </a> <li class=svelte-mm3tjv><a href=docs#Building class="svelte-mm3tjv section">Building </a> <a href=docs#sapper_build class="svelte-mm3tjv subsection" data-level=3>sapper build </a> <a href=docs#Browser_support class="svelte-mm3tjv subsection" data-level=3>Browser support </a> <li class=svelte-mm3tjv><a href=docs#Exporting class="svelte-mm3tjv section">Exporting </a> <a href=docs#sapper_export class="svelte-mm3tjv subsection" data-level=3>sapper export </a> <a href=docs#How_it_works class="svelte-mm3tjv subsection" data-level=3>How it works </a> <a href=docs#When_not_to_export class="svelte-mm3tjv subsection" data-level=3>When not to export </a> <a href=docs#Route_conflicts class="svelte-mm3tjv subsection" data-level=3>Route conflicts </a> <li class=svelte-mm3tjv><a href=docs#Deployment class="svelte-mm3tjv section">Deployment </a> <a href=docs#Deploying_to_Vercel class="svelte-mm3tjv subsection" data-level=3>Deploying to Vercel </a> <a href=docs#Deploying_service_workers class="svelte-mm3tjv subsection" data-level=3>Deploying service workers </a> <li class=svelte-mm3tjv><a href=docs#Security class="svelte-mm3tjv section">Security </a> <a href=docs#Content_Security_Policy_CSP class="svelte-mm3tjv subsection" data-level=3>Content Security Policy (CSP) </a> <li class=svelte-mm3tjv><a href=docs#Base_URLs class="svelte-mm3tjv section">Base URLs </a> <li class=svelte-mm3tjv><a href=docs#Testing class="svelte-mm3tjv section">Testing </a> <a href=docs#Running_the_tests class="svelte-mm3tjv subsection" data-level=3>Running the tests </a> <li class=svelte-mm3tjv><a href=docs#Debugging class="svelte-mm3tjv section">Debugging </a> </ul></div> <button class=svelte-a3bmb2> <svg class="icon svelte-5yec89" height=20 width=20><use xlink:href=#menu></use></svg></button></aside></main></div> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,(function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){return {sections:[{html:"\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"Before_we_begin\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#Before_we_begin\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tBefore we begin\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cblockquote\u003E\n\u003Cp\u003ESapper is in early development, and some things may change before we hit version 1.0. This document is a work-in-progress. If you get stuck, reach out for help in the \u003Ca href=\"https:\u002F\u002Fsvelte.dev\u002Fchat\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EDiscord chatroom\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003ESee the \u003Ca href=\"migrating\" rel=\"noopener noreferrer\"\u003Emigration guides\u003C\u002Fa\u003E for help upgrading from older versions.\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"What_is_Sapper\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#What_is_Sapper\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tWhat is Sapper?\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cp\u003ESapper is a framework for building extremely high-performance web apps. You&#39;re looking at one right now! There are two basic concepts:\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003EEach page of your app is a \u003Ca href=\"https:\u002F\u002Fsvelte.dev\" target=\"_blank\" rel=\"noopener noreferrer\"\u003ESvelte\u003C\u002Fa\u003E component\u003C\u002Fli\u003E\n\u003Cli\u003EYou create pages by adding files to the \u003Ccode\u003Esrc\u002Froutes\u003C\u002Fcode\u003E directory of your project. These will be server-rendered so that a user&#39;s first visit to your app is as fast as possible, then a client-side app takes over\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003EBuilding an app with all the modern best practices — code-splitting, offline support, server-rendered views with client-side hydration — is fiendishly complicated. Sapper does all the boring stuff for you so that you can get on with the creative part.\u003C\u002Fp\u003E\n\u003Cp\u003EYou don&#39;t need to know Svelte to understand the rest of this guide, but it will help. In short, it&#39;s a UI framework that compiles your components to highly optimized vanilla JavaScript. Read the \u003Ca href=\"https:\u002F\u002Fsvelte.dev\u002Fblog\u002Fsvelte-3-rethinking-reactivity\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Eintroductory blog post\u003C\u002Fa\u003E and the \u003Ca href=\"https:\u002F\u002Fsvelte.dev\u002Ftutorial\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Etutorial\u003C\u002Fa\u003E to learn more.\u003C\u002Fp\u003E\n\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"Why_the_name\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#Why_the_name\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tWhy the name?\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cp\u003EIn war, the soldiers who build bridges, repair roads, clear minefields and conduct demolitions — all under combat conditions — are known as \u003Cem\u003Esappers\u003C\u002Fem\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003EFor web developers, the stakes are generally lower than for combat engineers. But we face our own hostile environment: underpowered devices, poor network connections, and the complexity inherent in front-end engineering. Sapper, which is short for \u003Cb\u003ES\u003C\u002Fb\u003Evelte \u003Cb\u003Eapp\u003C\u002Fb\u003E mak\u003Cb\u003Eer\u003C\u002Fb\u003E, is your courageous and dutiful ally.\u003C\u002Fp\u003E\n\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"Comparison_with_Next_js\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#Comparison_with_Next_js\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tComparison with Next.js\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fzeit\u002Fnext.js\" target=\"_blank\" rel=\"noopener noreferrer\"\u003ENext.js\u003C\u002Fa\u003E is a React framework from \u003Ca href=\"https:\u002F\u002Fvercel.com\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EVercel (formerly ZEIT)\u003C\u002Fa\u003E, and is the inspiration for Sapper. There are a few notable differences, however:\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003ESapper is powered by Svelte instead of React, so it&#39;s faster and your apps are smaller\u003C\u002Fli\u003E\n\u003Cli\u003EAs well as \u003Cem\u003Epages\u003C\u002Fem\u003E, you can create \u003Cem\u003Eserver routes\u003C\u002Fem\u003E in your \u003Ccode\u003Esrc\u002Froutes\u003C\u002Fcode\u003E directory. This makes it very easy to, for example, add a JSON API such as the one powering this very page (try visiting \u003Ca href=\"\u002Fdocs.json\" rel=\"noopener noreferrer\"\u003E\u002Fdocs.json\u003C\u002Fa\u003E)\u003C\u002Fli\u003E\n\u003Cli\u003ELinks are just \u003Ccode\u003E&lt;a&gt;\u003C\u002Fcode\u003E elements, rather than framework-specific \u003Ccode\u003E&lt;Link&gt;\u003C\u002Fcode\u003E components. That means, for example, that \u003Ca href=\"\u002F\" rel=\"noopener noreferrer\"\u003Ethis link right here\u003C\u002Fa\u003E, despite being inside a blob of markdown, works with the router as you&#39;d expect\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"Getting_started\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#Getting_started\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tGetting started\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cp\u003EThe easiest way to start building a Sapper app is to clone the \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fsveltejs\u002Fsapper-template\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Esapper-template\u003C\u002Fa\u003E repo with \u003Ca href=\"https:\u002F\u002Fgithub.com\u002FRich-Harris\u002Fdegit\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Edegit\u003C\u002Fa\u003E:\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-bash'\u003E\u003Ccode\u003Enpx degit \u003Cspan class=\"hljs-string\"\u003E\"sveltejs\u002Fsapper-template#rollup\"\u003C\u002Fspan\u003E my-app\n\u003Cspan class=\"hljs-comment\"\u003E# or: npx degit \"sveltejs\u002Fsapper-template#webpack\" my-app\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-built_in\"\u003Ecd\u003C\u002Fspan\u003E my-app\nnpm install\nnpm run dev\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003EThis will scaffold a new project in the \u003Ccode\u003Emy-app\u003C\u002Fcode\u003E directory, install its dependencies, and start a server on \u003Ca href=\"http:\u002F\u002Flocalhost:3000\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Elocalhost:3000\u003C\u002Fa\u003E. Try editing the files to get a feel for how everything works – you may not need to bother reading the rest of this guide!\u003C\u002Fp\u003E\n",metadata:{title:c},subsections:[{slug:"Before_we_begin",title:"Before we begin",level:a},{slug:"What_is_Sapper",title:"What is Sapper?",level:a},{slug:"Why_the_name",title:"Why the name?",level:a},{slug:"Comparison_with_Next_js",title:"Comparison with Next.js",level:a},{slug:"Getting_started",title:"Getting started",level:a}],slug:c,file:"00-introduction.md"},{html:"\u003Cp\u003EThis section is a reference for the curious. We recommend you play around with the project template first, and come back here when you&#39;ve got a feel for how things fit together.\u003C\u002Fp\u003E\n\u003Cp\u003EIf you take a look inside the \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fsveltejs\u002Fsapper-template\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Esapper-template\u003C\u002Fa\u003E repo, you&#39;ll see some files that Sapper expects to find:\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-bash'\u003E\u003Ccode\u003E├ package.json\n├ src\n│ ├ routes\n│ │ ├ \u003Cspan class=\"hljs-comment\"\u003E# your routes here\u003C\u002Fspan\u003E\n│ │ ├ _error.svelte\n│ │ └ index.svelte\n│ ├ client.js\n│ ├ server.js\n│ ├ service-worker.js\n│ └ template.html\n├ static\n│ ├ \u003Cspan class=\"hljs-comment\"\u003E# your files here\u003C\u002Fspan\u003E\n└ rollup.config.js \u002F webpack.config.js\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003EWhen you first run Sapper, it will create an additional \u003Ccode\u003E__sapper__\u003C\u002Fcode\u003E directory containing generated files.\u003C\u002Fp\u003E\n\u003Cp\u003EYou&#39;ll notice a few extra files and a \u003Ccode\u003Ecypress\u003C\u002Fcode\u003E directory which relates to \u003Ca href=\"docs#Testing\" rel=\"noopener noreferrer\"\u003Etesting\u003C\u002Fa\u003E — we don&#39;t need to worry about those right now.\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003EYou \u003Cem\u003Ecan\u003C\u002Fem\u003E create these files from scratch, but it&#39;s much better to use the template. See \u003Ca href=\"docs#Getting_started\" rel=\"noopener noreferrer\"\u003Egetting started\u003C\u002Fa\u003E for instructions on how to easily clone it\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"package_json\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#package_json\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tpackage.json\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cp\u003EYour package.json contains your app&#39;s dependencies and defines a number of scripts:\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\u003Ccode\u003Enpm run dev\u003C\u002Fcode\u003E — start the app in development mode, and watch source files for changes\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode\u003Enpm run build\u003C\u002Fcode\u003E — build the app in production mode\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode\u003Enpm run export\u003C\u002Fcode\u003E — bake out a static version, if applicable (see \u003Ca href=\"docs#Exporting\" rel=\"noopener noreferrer\"\u003Eexporting\u003C\u002Fa\u003E)\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode\u003Enpm start\u003C\u002Fcode\u003E — start the app in production mode after you&#39;ve built it\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode\u003Enpm test\u003C\u002Fcode\u003E — run the tests (see \u003Ca href=\"docs#Testing\" rel=\"noopener noreferrer\"\u003Etesting\u003C\u002Fa\u003E)\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"src\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#src\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tsrc\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cp\u003EThis contains the three \u003Cem\u003Eentry points\u003C\u002Fem\u003E for your app — \u003Ccode\u003Esrc\u002Fclient.js\u003C\u002Fcode\u003E, \u003Ccode\u003Esrc\u002Fserver.js\u003C\u002Fcode\u003E and (optionally) \u003Ccode\u003Esrc\u002Fservice-worker.js\u003C\u002Fcode\u003E — along with a \u003Ccode\u003Esrc\u002Ftemplate.html\u003C\u002Fcode\u003E file.\u003C\u002Fp\u003E\n\n\t\t\t\t\t\u003Ch4\u003E\n\t\t\t\t\t\t\u003Cspan id=\"src_client_js\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#src_client_js\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tsrc\u002Fclient.js\n\t\t\t\t\t\u003C\u002Fh4\u003E\u003Cp\u003EThis \u003Cem\u003Emust\u003C\u002Fem\u003E import, and call, the \u003Ccode\u003Estart\u003C\u002Fcode\u003E function from the generated \u003Ccode\u003E@sapper\u002Fapp\u003C\u002Fcode\u003E module:\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-javascript'\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E * \u003Cspan class=\"hljs-keyword\"\u003Eas\u003C\u002Fspan\u003E sapper \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E'@sapper\u002Fapp'\u003C\u002Fspan\u003E;\n\nsapper.start({\n\t\u003Cspan class=\"hljs-attr\"\u003Etarget\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-built_in\"\u003Edocument\u003C\u002Fspan\u003E.querySelector(\u003Cspan class=\"hljs-string\"\u003E'#sapper'\u003C\u002Fspan\u003E)\n});\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003EIn many cases, that&#39;s the entirety of your entry module, though you can do as much or as little here as you wish. See the \u003Ca href=\"docs#Client_API\" rel=\"noopener noreferrer\"\u003Eclient API\u003C\u002Fa\u003E section for more information on functions you can import.\u003C\u002Fp\u003E\n\n\t\t\t\t\t\u003Ch4\u003E\n\t\t\t\t\t\t\u003Cspan id=\"src_server_js\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#src_server_js\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tsrc\u002Fserver.js\n\t\t\t\t\t\u003C\u002Fh4\u003E\u003Cp\u003EThis is a normal Express (or \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Flukeed\u002Fpolka\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EPolka\u003C\u002Fa\u003E, etc) app, with three requirements:\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003Eit should serve the contents of the \u003Ccode\u003Estatic\u003C\u002Fcode\u003E folder, using for example \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Flukeed\u002Fsirv\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Esirv\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003Eit should call \u003Ccode\u003Eapp.use(sapper.middleware())\u003C\u002Fcode\u003E at the end, where \u003Ccode\u003Esapper\u003C\u002Fcode\u003E is imported from \u003Ccode\u003E@sapper\u002Fserver\u003C\u002Fcode\u003E\u003C\u002Fli\u003E\n\u003Cli\u003Eit must listen on \u003Ccode\u003Eprocess.env.PORT\u003C\u002Fcode\u003E\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003EBeyond that, you can write the server however you like.\u003C\u002Fp\u003E\n\n\t\t\t\t\t\u003Ch4\u003E\n\t\t\t\t\t\t\u003Cspan id=\"src_service-worker_js\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#src_service-worker_js\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tsrc\u002Fservice-worker.js\n\t\t\t\t\t\u003C\u002Fh4\u003E\u003Cp\u003EService workers act as proxy servers that give you fine-grained control over how to respond to network requests. For example, when the browser requests \u003Ccode\u003E\u002Fgoats.jpg\u003C\u002Fcode\u003E, the service worker can respond with a file it previously cached, or it can pass the request on to the server, or it could even respond with something completely different, such as a picture of llamas.\u003C\u002Fp\u003E\n\u003Cp\u003EAmong other things, this makes it possible to build applications that work offline.\u003C\u002Fp\u003E\n\u003Cp\u003EBecause every app needs a slightly different service worker (sometimes it&#39;s appropriate to always serve from the cache, sometimes that should only be a last resort in case of no connectivity), Sapper doesn&#39;t attempt to control the service worker. Instead, you write the logic in \u003Ccode\u003Eservice-worker.js\u003C\u002Fcode\u003E. You can import any of the following from \u003Ccode\u003E@sapper\u002Fservice-worker\u003C\u002Fcode\u003E:\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\u003Ccode\u003Efiles\u003C\u002Fcode\u003E — an array of files found in the \u003Ccode\u003Estatic\u003C\u002Fcode\u003E directory\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode\u003Eshell\u003C\u002Fcode\u003E — the client-side JavaScript generated by the bundler (Rollup or webpack)\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode\u003Eroutes\u003C\u002Fcode\u003E — an array of \u003Ccode\u003E{ pattern: RegExp }\u003C\u002Fcode\u003E objects you can use to determine whether a Sapper-controlled page is being requested\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode\u003Etimestamp\u003C\u002Fcode\u003E — the time the service worker was generated (useful for generating unique cache names)\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\t\t\t\t\t\u003Ch4\u003E\n\t\t\t\t\t\t\u003Cspan id=\"src_template_html\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#src_template_html\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tsrc\u002Ftemplate.html\n\t\t\t\t\t\u003C\u002Fh4\u003E\u003Cp\u003EThis file is a template for responses from the server. Sapper will inject content that replaces the following tags:\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\u003Ccode\u003E%sapper.base%\u003C\u002Fcode\u003E — a \u003Ccode\u003E&lt;base&gt;\u003C\u002Fcode\u003E element (see \u003Ca href=\"docs#Base_URLs\" rel=\"noopener noreferrer\"\u003Ebase URLs\u003C\u002Fa\u003E)\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode\u003E%sapper.styles%\u003C\u002Fcode\u003E — critical CSS for the page being requested\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode\u003E%sapper.head%\u003C\u002Fcode\u003E — HTML representing page-specific \u003Ccode\u003E&lt;head&gt;\u003C\u002Fcode\u003E contents, like \u003Ccode\u003E&lt;title&gt;\u003C\u002Fcode\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode\u003E%sapper.html%\u003C\u002Fcode\u003E — HTML representing the body of the page being rendered\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode\u003E%sapper.scripts%\u003C\u002Fcode\u003E — script tags for the client-side app\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"src_routes\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#src_routes\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tsrc\u002Froutes\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cp\u003EThis is the meat of your app — the pages and server routes. See the section on \u003Ca href=\"docs#Routing\" rel=\"noopener noreferrer\"\u003Erouting\u003C\u002Fa\u003E for the juicy details.\u003C\u002Fp\u003E\n\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"static\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#static\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tstatic\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cp\u003EThis is a place to put any files that your app uses — fonts, images and so on. For example \u003Ccode\u003Estatic\u002Ffavicon.png\u003C\u002Fcode\u003E will be served as \u003Ccode\u003E\u002Ffavicon.png\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003ESapper doesn&#39;t serve these files — you&#39;d typically use \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Flukeed\u002Fsirv\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Esirv\u003C\u002Fa\u003E or \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fexpressjs\u002Fserve-static\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Eserve-static\u003C\u002Fa\u003E for that — but it will read the contents of the \u003Ccode\u003Estatic\u003C\u002Fcode\u003E folder so that you can easily generate a cache manifest for offline support (see \u003Ca href=\"docs#src_service-worker_js\" rel=\"noopener noreferrer\"\u003Eservice-worker.js\u003C\u002Fa\u003E).\u003C\u002Fp\u003E\n\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"rollup_config_js_webpack_config_js\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#rollup_config_js_webpack_config_js\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\trollup.config.js \u002F webpack.config.js\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cp\u003ESapper can use \u003Ca href=\"https:\u002F\u002Frollupjs.org\u002F\" target=\"_blank\" rel=\"noopener noreferrer\"\u003ERollup\u003C\u002Fa\u003E or \u003Ca href=\"https:\u002F\u002Fwebpack.js.org\u002F\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Ewebpack\u003C\u002Fa\u003E to bundle your app. You probably won&#39;t need to change the config, but if you want to (for example to add new loaders or plugins), you can.\u003C\u002Fp\u003E\n",metadata:{title:"Sapper app structure"},subsections:[{slug:"package_json",title:"package.json",level:a},{slug:d,title:d,level:a},{slug:"src_client_js",title:"src\u002Fclient.js",level:b},{slug:"src_server_js",title:"src\u002Fserver.js",level:b},{slug:"src_service-worker_js",title:"src\u002Fservice-worker.js",level:b},{slug:"src_template_html",title:"src\u002Ftemplate.html",level:b},{slug:"src_routes",title:"src\u002Froutes",level:a},{slug:e,title:e,level:a},{slug:"rollup_config_js_webpack_config_js",title:"rollup.config.js \u002F webpack.config.js",level:a}],slug:"Sapper_app_structure",file:"01-structure.md"},{html:"\u003Cp\u003EAs we&#39;ve seen, there are two types of route in Sapper — pages, and server routes.\u003C\u002Fp\u003E\n\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"Pages\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#Pages\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tPages\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cp\u003EPages are Svelte components written in \u003Ccode\u003E.svelte\u003C\u002Fcode\u003E files. When a user first visits the application, they will be served a server-rendered version of the route in question, plus some JavaScript that &#39;hydrates&#39; the page and initialises a client-side router. From that point forward, navigating to other pages is handled entirely on the client for a fast, app-like feel.\u003C\u002Fp\u003E\n\u003Cp\u003EThe filename determines the route. For example, \u003Ccode\u003Esrc\u002Froutes\u002Findex.svelte\u003C\u002Fcode\u003E is the root of your site:\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-markup'\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-comment\"\u003E&lt;!-- src\u002Froutes\u002Findex.svelte --&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Esvelte:head\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Etitle\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003EWelcome\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Etitle\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Esvelte:head\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003EHello and welcome to my site!\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003EA file called either \u003Ccode\u003Esrc\u002Froutes\u002Fabout.svelte\u003C\u002Fcode\u003E or \u003Ccode\u003Esrc\u002Froutes\u002Fabout\u002Findex.svelte\u003C\u002Fcode\u003E would correspond to the \u003Ccode\u003E\u002Fabout\u003C\u002Fcode\u003E route:\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-markup'\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-comment\"\u003E&lt;!-- src\u002Froutes\u002Fabout.svelte --&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Esvelte:head\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Etitle\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003EAbout\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Etitle\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Esvelte:head\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003EAbout this site\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Ep\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003ETODO...\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Ep\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003EDynamic parameters are encoded using \u003Ccode\u003E[brackets]\u003C\u002Fcode\u003E. For example, here&#39;s how you could create a page that renders a blog post:\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-markup'\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-comment\"\u003E&lt;!-- src\u002Froutes\u002Fblog\u002F[slug].svelte --&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Econtext\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"module\"\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"javascript\"\u003E\n\t\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F the (optional) preload function takes a\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F `{ path, params, query }` object and turns it into\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F the data we need to render the page\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"hljs-keyword\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Easync\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Epreload\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-params\"\u003Epage, session\u003C\u002Fspan\u003E) \u003C\u002Fspan\u003E{\n\t\t\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F the `slug` parameter is available because this file\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F is called [slug].svelte\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E { slug } = page.params;\n\n\t\t\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F `this.fetch` is a wrapper around `fetch` that allows\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F you to make credentialled requests on both\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F server and client\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E res = \u003Cspan class=\"hljs-keyword\"\u003Eawait\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Ethis\u003C\u002Fspan\u003E.fetch(\u003Cspan class=\"hljs-string\"\u003E`blog\u002F\u003Cspan class=\"hljs-subst\"\u003E${slug}\u003C\u002Fspan\u003E.json`\u003C\u002Fspan\u003E);\n\t\t\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E article = \u003Cspan class=\"hljs-keyword\"\u003Eawait\u003C\u002Fspan\u003E res.json();\n\n\t\t\u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E { article };\n\t}\n\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"javascript\"\u003E\n\t\u003Cspan class=\"hljs-keyword\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E article;\n\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Esvelte:head\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Etitle\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E{article.title}\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Etitle\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Esvelte:head\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E{article.title}\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Ediv\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Eclass\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E'content'\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\t{@html article.html}\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003EIf you want to capture more params, you can create nested folders using the same naming convention: \u003Ccode\u003E[slug]\u002F[language]\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003EIf you don&#39;t want to create several folders to capture more than one parameter like \u003Ccode\u003E[year]\u002F[month]\u002F...\u003C\u002Fcode\u003E, or if the number of parameters is dynamic, you can use a spread route parameter. For example, instead of individually capturing \u003Ccode\u003E\u002Fblog\u002F[slug]\u002F[year]\u002F[month]\u002F[day]\u003C\u002Fcode\u003E, you can create a file for \u003Ccode\u003E\u002Fblog\u002F[...slug].svelte\u003C\u002Fcode\u003E and extract the params like so:\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-markup'\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-comment\"\u003E&lt;!-- src\u002Froutes\u002Fblog\u002F[...slug].svelte --&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Econtext\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"module\"\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"javascript\"\u003E\n\t\u003Cspan class=\"hljs-keyword\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Easync\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Epreload\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-params\"\u003E{ params }\u003C\u002Fspan\u003E) \u003C\u002Fspan\u003E{\n\t\t\u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E [slug, year, month, day] = params.slug;\n\n\t\t\u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E { slug, year, month, day };\n\t}\n\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cblockquote\u003E\n\u003Cp\u003ESee the section on \u003Ca href=\"docs#Preloading\" rel=\"noopener noreferrer\"\u003Epreloading\u003C\u002Fa\u003E for more info about \u003Ccode\u003Epreload\u003C\u002Fcode\u003E and \u003Ccode\u003Ethis.fetch\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"Server_routes\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#Server_routes\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tServer routes\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cp\u003EServer routes are modules written in \u003Ccode\u003E.js\u003C\u002Fcode\u003E files that export functions corresponding to HTTP methods. Each function receives HTTP \u003Ccode\u003Erequest\u003C\u002Fcode\u003E and \u003Ccode\u003Eresponse\u003C\u002Fcode\u003E objects as arguments, plus a \u003Ccode\u003Enext\u003C\u002Fcode\u003E function. This is useful for creating a JSON API. For example, here&#39;s how you could create an endpoint that served the blog page above:\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-javascript'\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F routes\u002Fblog\u002F[slug].json.js\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E db \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E'.\u002F_database.js'\u003C\u002Fspan\u003E; \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F the underscore tells Sapper this isn't a route\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-keyword\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Easync\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Eget\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-params\"\u003Ereq, res, next\u003C\u002Fspan\u003E) \u003C\u002Fspan\u003E{\n\t\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F the `slug` parameter is available because this file\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F is called [slug].json.js\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E { slug } = req.params;\n\n\t\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E article = \u003Cspan class=\"hljs-keyword\"\u003Eawait\u003C\u002Fspan\u003E db.get(slug);\n\n\t\u003Cspan class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E (article !== \u003Cspan class=\"hljs-literal\"\u003Enull\u003C\u002Fspan\u003E) {\n\t\tres.setHeader(\u003Cspan class=\"hljs-string\"\u003E'Content-Type'\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-string\"\u003E'application\u002Fjson'\u003C\u002Fspan\u003E);\n\t\tres.end(\u003Cspan class=\"hljs-built_in\"\u003EJSON\u003C\u002Fspan\u003E.stringify(article));\n\t} \u003Cspan class=\"hljs-keyword\"\u003Eelse\u003C\u002Fspan\u003E {\n\t\tnext();\n\t}\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cblockquote\u003E\n\u003Cp\u003E\u003Ccode\u003Edelete\u003C\u002Fcode\u003E is a reserved word in JavaScript. To handle DELETE requests, export a function called \u003Ccode\u003Edel\u003C\u002Fcode\u003E instead.\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"File_naming_rules\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#File_naming_rules\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tFile naming rules\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cp\u003EThere are three simple rules for naming the files that define your routes:\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003EA file called \u003Ccode\u003Esrc\u002Froutes\u002Fabout.svelte\u003C\u002Fcode\u003E corresponds to the \u003Ccode\u003E\u002Fabout\u003C\u002Fcode\u003E route. A file called \u003Ccode\u003Esrc\u002Froutes\u002Fblog\u002F[slug].svelte\u003C\u002Fcode\u003E corresponds to the \u003Ccode\u003E\u002Fblog\u002F:slug\u003C\u002Fcode\u003E route, in which case \u003Ccode\u003Eparams.slug\u003C\u002Fcode\u003E is available to \u003Ccode\u003Epreload\u003C\u002Fcode\u003E\u003C\u002Fli\u003E\n\u003Cli\u003EThe file \u003Ccode\u003Esrc\u002Froutes\u002Findex.svelte\u003C\u002Fcode\u003E corresponds to the root of your app. \u003Ccode\u003Esrc\u002Froutes\u002Fabout\u002Findex.svelte\u003C\u002Fcode\u003E is treated the same as \u003Ccode\u003Esrc\u002Froutes\u002Fabout.svelte\u003C\u002Fcode\u003E.\u003C\u002Fli\u003E\n\u003Cli\u003EFiles and directories with a leading underscore do \u003Cem\u003Enot\u003C\u002Fem\u003E create routes. This allows you to colocate helper modules and components with the routes that depend on them — for example you could have a file called \u003Ccode\u003Esrc\u002Froutes\u002F_helpers\u002Fdatetime.js\u003C\u002Fcode\u003E and it would \u003Cem\u003Enot\u003C\u002Fem\u003E create a \u003Ccode\u003E\u002F_helpers\u002Fdatetime\u003C\u002Fcode\u003E route\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"Error_page\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#Error_page\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tError page\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cp\u003EIn addition to regular pages, there is a &#39;special&#39; page that Sapper expects to find — \u003Ccode\u003Esrc\u002Froutes\u002F_error.svelte\u003C\u002Fcode\u003E. This will be shown when an error occurs while rendering a page.\u003C\u002Fp\u003E\n\u003Cp\u003EThe \u003Ccode\u003Eerror\u003C\u002Fcode\u003E object is made available to the template along with the HTTP \u003Ccode\u003Estatus\u003C\u002Fcode\u003E code.\u003C\u002Fp\u003E\n\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"Regexes_in_routes\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#Regexes_in_routes\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tRegexes in routes\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cp\u003EYou can use a subset of regular expressions to qualify route parameters, by placing them in parentheses after the parameter name.\u003C\u002Fp\u003E\n\u003Cp\u003EFor example, \u003Ccode\u003Esrc\u002Froutes\u002Fitems\u002F[id([0-9]+)].svelte\u003C\u002Fcode\u003E would only match numeric IDs — \u003Ccode\u003E\u002Fitems\u002F123\u003C\u002Fcode\u003E would match and make the value \u003Ccode\u003E123\u003C\u002Fcode\u003E available in \u003Ccode\u003Epage.params.id\u003C\u002Fcode\u003E, but \u003Ccode\u003E\u002Fitems\u002Fxyz\u003C\u002Fcode\u003E would not match.\u003C\u002Fp\u003E\n\u003Cp\u003EBecause of technical limitations, the following characters cannot be used: \u003Ccode\u003E\u002F\u003C\u002Fcode\u003E, \u003Ccode\u003E\\\u003C\u002Fcode\u003E, \u003Ccode\u003E?\u003C\u002Fcode\u003E, \u003Ccode\u003E:\u003C\u002Fcode\u003E, \u003Ccode\u003E(\u003C\u002Fcode\u003E and \u003Ccode\u003E)\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n",metadata:{title:f},subsections:[{slug:g,title:g,level:a},{slug:"Server_routes",title:"Server routes",level:a},{slug:"File_naming_rules",title:"File naming rules",level:a},{slug:"Error_page",title:"Error page",level:a},{slug:"Regexes_in_routes",title:"Regexes in routes",level:a}],slug:f,file:"02-routing.md"},{html:"\u003Cp\u003EThe \u003Ccode\u003E@sapper\u002Fapp\u003C\u002Fcode\u003E module, which is generated by Sapper based on the shape of your app, contains functions for controlling Sapper programmatically and responding to events.\u003C\u002Fp\u003E\n\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"start_target\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#start_target\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tstart({ target })\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cul\u003E\n\u003Cli\u003E\u003Ccode\u003Etarget\u003C\u002Fcode\u003E — an element to render pages to\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003EThis configures the router and starts the application — listens for clicks on \u003Ccode\u003E&lt;a&gt;\u003C\u002Fcode\u003E elements, interacts with the \u003Ccode\u003Ehistory\u003C\u002Fcode\u003E API, and renders and updates your Svelte components.\u003C\u002Fp\u003E\n\u003Cp\u003EReturns a \u003Ccode\u003EPromise\u003C\u002Fcode\u003E that resolves when the initial page has been hydrated.\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-javascript'\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E * \u003Cspan class=\"hljs-keyword\"\u003Eas\u003C\u002Fspan\u003E sapper \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E'@sapper\u002Fapp'\u003C\u002Fspan\u003E;\n\nsapper.start({\n\t\u003Cspan class=\"hljs-attr\"\u003Etarget\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-built_in\"\u003Edocument\u003C\u002Fspan\u003E.querySelector(\u003Cspan class=\"hljs-string\"\u003E'#sapper'\u003C\u002Fspan\u003E)\n}).then(\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-params\"\u003E()\u003C\u002Fspan\u003E =&gt;\u003C\u002Fspan\u003E {\n\t\u003Cspan class=\"hljs-built_in\"\u003Econsole\u003C\u002Fspan\u003E.log(\u003Cspan class=\"hljs-string\"\u003E'client-side app has started'\u003C\u002Fspan\u003E);\n});\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"goto_href_options\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#goto_href_options\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tgoto(href, options?)\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cul\u003E\n\u003Cli\u003E\u003Ccode\u003Ehref\u003C\u002Fcode\u003E — the page to go to\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode\u003Eoptions\u003C\u002Fcode\u003E — can include a \u003Ccode\u003EreplaceState\u003C\u002Fcode\u003E property, which determines whether to use \u003Ccode\u003Ehistory.pushState\u003C\u002Fcode\u003E (the default) or \u003Ccode\u003Ehistory.replaceState\u003C\u002Fcode\u003E. Not required\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003EProgrammatically navigates to the given \u003Ccode\u003Ehref\u003C\u002Fcode\u003E. If the destination is a Sapper route, Sapper will handle the navigation, otherwise the page will be reloaded with the new \u003Ccode\u003Ehref\u003C\u002Fcode\u003E. In other words, the behaviour is as though the user clicked on a link with this \u003Ccode\u003Ehref\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003EReturns a \u003Ccode\u003EPromise\u003C\u002Fcode\u003E that resolves when the navigation is complete. This can be used to perform actions once the navigation has completed, such as updating a database, store, etc.\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-javascript'\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E { goto } \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E'@sapper\u002Fapp'\u003C\u002Fspan\u003E;\n\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E navigateAndSave = \u003Cspan class=\"hljs-keyword\"\u003Easync\u003C\u002Fspan\u003E () =&gt; {\n\t\u003Cspan class=\"hljs-keyword\"\u003Eawait\u003C\u002Fspan\u003E goto(\u003Cspan class=\"hljs-string\"\u003E'\u002F'\u003C\u002Fspan\u003E);\n\tsaveItem();\n}\n\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E saveItem = \u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-params\"\u003E()\u003C\u002Fspan\u003E =&gt;\u003C\u002Fspan\u003E {\n\t\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F do something with the database\u003C\u002Fspan\u003E\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"prefetch_href\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#prefetch_href\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tprefetch(href)\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cul\u003E\n\u003Cli\u003E\u003Ccode\u003Ehref\u003C\u002Fcode\u003E — the page to prefetch\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003EProgrammatically prefetches the given page, which means a) ensuring that the code for the page is loaded, and b) calling the page&#39;s \u003Ccode\u003Epreload\u003C\u002Fcode\u003E method with the appropriate options. This is the same behaviour that Sapper triggers when the user taps or mouses over an \u003Ccode\u003E&lt;a&gt;\u003C\u002Fcode\u003E element with \u003Ca href=\"docs#rel_prefetch\" rel=\"noopener noreferrer\"\u003Erel=prefetch\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003EReturns a \u003Ccode\u003EPromise\u003C\u002Fcode\u003E that resolves when the prefetch is complete.\u003C\u002Fp\u003E\n\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"prefetchRoutes_routes\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#prefetchRoutes_routes\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tprefetchRoutes(routes?)\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cul\u003E\n\u003Cli\u003E\u003Ccode\u003Eroutes\u003C\u002Fcode\u003E — an optional array of strings representing routes to prefetch\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003EProgrammatically prefetches the code for routes that haven&#39;t yet been fetched. Typically, you might call this after \u003Ccode\u003Esapper.start()\u003C\u002Fcode\u003E is complete, to speed up subsequent navigation (this is the &#39;L&#39; of the \u003Ca href=\"https:\u002F\u002Fdevelopers.google.com\u002Fweb\u002Ffundamentals\u002Fperformance\u002Fprpl-pattern\u002F\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EPRPL pattern\u003C\u002Fa\u003E). Omitting arguments will cause all routes to be fetched, or you can specify routes by any matching pathname such as \u003Ccode\u003E\u002Fabout\u003C\u002Fcode\u003E (to match \u003Ccode\u003Esrc\u002Froutes\u002Fabout.svelte\u003C\u002Fcode\u003E) or \u003Ccode\u003E\u002Fblog\u002F*\u003C\u002Fcode\u003E (to match \u003Ccode\u003Esrc\u002Froutes\u002Fblog\u002F[slug].svelte\u003C\u002Fcode\u003E). Unlike \u003Ccode\u003Eprefetch\u003C\u002Fcode\u003E, this won&#39;t call \u003Ccode\u003Epreload\u003C\u002Fcode\u003E for individual pages.\u003C\u002Fp\u003E\n\u003Cp\u003EReturns a \u003Ccode\u003EPromise\u003C\u002Fcode\u003E that resolves when the routes have been prefetched.\u003C\u002Fp\u003E\n",metadata:{title:"Client API"},subsections:[{slug:"start_target",title:"start({ target })",level:a},{slug:"goto_href_options",title:"goto(href, options?)",level:a},{slug:"prefetch_href",title:"prefetch(href)",level:a},{slug:"prefetchRoutes_routes",title:"prefetchRoutes(routes?)",level:a}],slug:"Client_API",file:"03-client-api.md"},{html:"\u003Cp\u003EAs seen in the \u003Ca href=\"docs#Routing\" rel=\"noopener noreferrer\"\u003Erouting\u003C\u002Fa\u003E section, page components can have an optional \u003Ccode\u003Epreload\u003C\u002Fcode\u003E function that will load some data that the page depends on. This is similar to \u003Ccode\u003EgetInitialProps\u003C\u002Fcode\u003E in Next.js or \u003Ccode\u003EasyncData\u003C\u002Fcode\u003E in Nuxt.js.\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-markup'\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Econtext\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"module\"\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"javascript\"\u003E\n\t\u003Cspan class=\"hljs-keyword\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Easync\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Epreload\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-params\"\u003Epage, session\u003C\u002Fspan\u003E) \u003C\u002Fspan\u003E{\n\t\t\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E { slug } = page.params;\n\n\t\t\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E res = \u003Cspan class=\"hljs-keyword\"\u003Eawait\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Ethis\u003C\u002Fspan\u003E.fetch(\u003Cspan class=\"hljs-string\"\u003E`blog\u002F\u003Cspan class=\"hljs-subst\"\u003E${slug}\u003C\u002Fspan\u003E.json`\u003C\u002Fspan\u003E);\n\t\t\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E article = \u003Cspan class=\"hljs-keyword\"\u003Eawait\u003C\u002Fspan\u003E res.json();\n\n\t\t\u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E { article };\n\t}\n\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"javascript\"\u003E\n\t\u003Cspan class=\"hljs-keyword\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E article;\n\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E{article.title}\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003EIt lives in a \u003Ccode\u003Econtext=&quot;module&quot;\u003C\u002Fcode\u003E script — see the \u003Ca href=\"https:\u002F\u002Fsvelte.dev\u002Ftutorial\u002Fmodule-exports\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Etutorial\u003C\u002Fa\u003E — because it&#39;s not part of the component instance itself; instead, it runs \u003Cem\u003Ebefore\u003C\u002Fem\u003E the component is created, allowing you to avoid flashes while data is fetched.\u003C\u002Fp\u003E\n\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"Arguments\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#Arguments\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tArguments\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cp\u003EThe \u003Ccode\u003Epreload\u003C\u002Fcode\u003E function receives two arguments — \u003Ccode\u003Epage\u003C\u002Fcode\u003E and \u003Ccode\u003Esession\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ccode\u003Epage\u003C\u002Fcode\u003E is a \u003Ccode\u003E{ host, path, params, query }\u003C\u002Fcode\u003E object where \u003Ccode\u003Ehost\u003C\u002Fcode\u003E is the URL&#39;s host, \u003Ccode\u003Epath\u003C\u002Fcode\u003E is its pathname, \u003Ccode\u003Eparams\u003C\u002Fcode\u003E is derived from \u003Ccode\u003Epath\u003C\u002Fcode\u003E and the route filename, and \u003Ccode\u003Equery\u003C\u002Fcode\u003E is an object of values in the query string.\u003C\u002Fp\u003E\n\u003Cp\u003ESo if the example above was \u003Ccode\u003Esrc\u002Froutes\u002Fblog\u002F[slug].svelte\u003C\u002Fcode\u003E and the URL was \u003Ccode\u003E\u002Fblog\u002Fsome-post?foo=bar&amp;baz\u003C\u002Fcode\u003E, the following would be true:\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\u003Ccode\u003Epage.path === &#39;\u002Fblog\u002Fsome-post&#39;\u003C\u002Fcode\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode\u003Epage.params.slug === &#39;some-post&#39;\u003C\u002Fcode\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode\u003Epage.query.foo === &#39;bar&#39;\u003C\u002Fcode\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode\u003Epage.query.baz === true\u003C\u002Fcode\u003E\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003E\u003Ccode\u003Esession\u003C\u002Fcode\u003E is generated on the server by the \u003Ccode\u003Esession\u003C\u002Fcode\u003E option passed to \u003Ccode\u003Esapper.middleware\u003C\u002Fcode\u003E. For example:\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-javascript'\u003E\u003Ccode\u003Esapper.middleware({\n\t\u003Cspan class=\"hljs-attr\"\u003Esession\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-function\"\u003E(\u003Cspan class=\"hljs-params\"\u003Ereq, res\u003C\u002Fspan\u003E) =&gt;\u003C\u002Fspan\u003E ({\n\t\t\u003Cspan class=\"hljs-attr\"\u003Euser\u003C\u002Fspan\u003E: req.user\n\t})\n})\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"Return_value\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#Return_value\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tReturn value\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cp\u003EIf you return a Promise from \u003Ccode\u003Epreload\u003C\u002Fcode\u003E, the page will delay rendering until the promise resolves. You can also return a plain object. In both cases, the values in the object will be passed into the components as props.\u003C\u002Fp\u003E\n\u003Cp\u003EWhen Sapper renders a page on the server, it will attempt to serialize the resolved value (using \u003Ca href=\"https:\u002F\u002Fgithub.com\u002FRich-Harris\u002Fdevalue\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Edevalue\u003C\u002Fa\u003E) and include it on the page, so that the client doesn&#39;t also need to call \u003Ccode\u003Epreload\u003C\u002Fcode\u003E upon initialization. Serialization will fail if the value includes functions or custom classes (cyclical and repeated references are fine, as are built-ins like \u003Ccode\u003EDate\u003C\u002Fcode\u003E, \u003Ccode\u003EMap\u003C\u002Fcode\u003E, \u003Ccode\u003ESet\u003C\u002Fcode\u003E and \u003Ccode\u003ERegExp\u003C\u002Fcode\u003E).\u003C\u002Fp\u003E\n\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"Context\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#Context\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tContext\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cp\u003EInside \u003Ccode\u003Epreload\u003C\u002Fcode\u003E, you have access to three methods:\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\u003Ccode\u003Ethis.fetch(url, options)\u003C\u002Fcode\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode\u003Ethis.error(statusCode, error)\u003C\u002Fcode\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode\u003Ethis.redirect(statusCode, location)\u003C\u002Fcode\u003E\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\t\t\t\t\t\u003Ch4\u003E\n\t\t\t\t\t\t\u003Cspan id=\"this_fetch\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#this_fetch\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tthis.fetch\n\t\t\t\t\t\u003C\u002Fh4\u003E\u003Cp\u003EIn browsers, you can use \u003Ccode\u003Efetch\u003C\u002Fcode\u003E to make AJAX requests, for getting data from your server routes (among other things). On the server it&#39;s a little trickier — you can make HTTP requests, but you must specify an origin, and you don&#39;t have access to cookies. This means that it&#39;s impossible to request data based on the user&#39;s session, such as data that requires you to be logged in.\u003C\u002Fp\u003E\n\u003Cp\u003ETo fix this, Sapper provides \u003Ccode\u003Ethis.fetch\u003C\u002Fcode\u003E, which works on the server as well as in the client:\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-markup'\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Econtext\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"module\"\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"javascript\"\u003E\n\t\u003Cspan class=\"hljs-keyword\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Easync\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Epreload\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-params\"\u003E\u003C\u002Fspan\u003E) \u003C\u002Fspan\u003E{\n\t\t\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E res = \u003Cspan class=\"hljs-keyword\"\u003Eawait\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Ethis\u003C\u002Fspan\u003E.fetch(\u003Cspan class=\"hljs-string\"\u003E`secret-data.json`\u003C\u002Fspan\u003E, {\n\t\t\t\u003Cspan class=\"hljs-attr\"\u003Ecredentials\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-string\"\u003E'include'\u003C\u002Fspan\u003E\n\t\t});\n\n\t\t\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F ...\u003C\u002Fspan\u003E\n\t}\n\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003EIt is important to note that \u003Ccode\u003Epreload\u003C\u002Fcode\u003E may run on either the server or in the client browser. Code called inside \u003Ccode\u003Epreload\u003C\u002Fcode\u003E blocks:\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003Eshould run on the same domain as any upstream API servers requiring credentials; otherwise, \u003Ccode\u003Ecredentials: &#39;include&#39;\u003C\u002Fcode\u003E cannot guarantee access to 3rd party session cookies\u003C\u002Fli\u003E\n\u003Cli\u003Eshould not reference \u003Ccode\u003Ewindow\u003C\u002Fcode\u003E, \u003Ccode\u003Edocument\u003C\u002Fcode\u003E or any browser-specific objects\u003C\u002Fli\u003E\n\u003Cli\u003Eshould not reference any API keys or secrets, which will be exposed to the client\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003EIf you are using Sapper as an authentication\u002Fauthorization server, you can use session middleware such as \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fexpressjs\u002Fsession\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Eexpress-session\u003C\u002Fa\u003E in your \u003Ccode\u003Eapp\u002Fserver.js\u003C\u002Fcode\u003E in order to maintain user sessions.\u003C\u002Fp\u003E\n\n\t\t\t\t\t\u003Ch4\u003E\n\t\t\t\t\t\t\u003Cspan id=\"this_error\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#this_error\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tthis.error\n\t\t\t\t\t\u003C\u002Fh4\u003E\u003Cp\u003EIf the user navigated to \u003Ccode\u003E\u002Fblog\u002Fsome-invalid-slug\u003C\u002Fcode\u003E, we would want to render a 404 Not Found page. We can do that with \u003Ccode\u003Ethis.error\u003C\u002Fcode\u003E:\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-markup'\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Econtext\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"module\"\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"javascript\"\u003E\n\t\u003Cspan class=\"hljs-keyword\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Easync\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Epreload\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-params\"\u003E{ params, query }\u003C\u002Fspan\u003E) \u003C\u002Fspan\u003E{\n\t\t\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E { slug } = params;\n\n\t\t\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E res = \u003Cspan class=\"hljs-keyword\"\u003Eawait\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Ethis\u003C\u002Fspan\u003E.fetch(\u003Cspan class=\"hljs-string\"\u003E`blog\u002F\u003Cspan class=\"hljs-subst\"\u003E${slug}\u003C\u002Fspan\u003E.json`\u003C\u002Fspan\u003E);\n\n\t\t\u003Cspan class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E (res.status === \u003Cspan class=\"hljs-number\"\u003E200\u003C\u002Fspan\u003E) {\n\t\t\t\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E article = \u003Cspan class=\"hljs-keyword\"\u003Eawait\u003C\u002Fspan\u003E res.json();\n\t\t\t\u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E { article };\n\t\t}\n\n\t\t\u003Cspan class=\"hljs-keyword\"\u003Ethis\u003C\u002Fspan\u003E.error(\u003Cspan class=\"hljs-number\"\u003E404\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-string\"\u003E'Not found'\u003C\u002Fspan\u003E);\n\t}\n\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003EThe same applies to other error codes you might encounter.\u003C\u002Fp\u003E\n\n\t\t\t\t\t\u003Ch4\u003E\n\t\t\t\t\t\t\u003Cspan id=\"this_redirect\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#this_redirect\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tthis.redirect\n\t\t\t\t\t\u003C\u002Fh4\u003E\u003Cp\u003EYou can abort rendering and redirect to a different location with \u003Ccode\u003Ethis.redirect\u003C\u002Fcode\u003E:\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-markup'\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Econtext\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"module\"\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"javascript\"\u003E\n\t\u003Cspan class=\"hljs-keyword\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Easync\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Epreload\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-params\"\u003Epage, session\u003C\u002Fspan\u003E) \u003C\u002Fspan\u003E{\n\t\t\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E { user } = session;\n\n\t\t\u003Cspan class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E (!user) {\n\t\t\t\u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Ethis\u003C\u002Fspan\u003E.redirect(\u003Cspan class=\"hljs-number\"\u003E302\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-string\"\u003E'login'\u003C\u002Fspan\u003E);\n\t\t}\n\n\t\t\u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E { user };\n\t}\n\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E",metadata:{title:h},subsections:[{slug:i,title:i,level:a},{slug:"Return_value",title:"Return value",level:a},{slug:j,title:j,level:a},{slug:"this_fetch",title:"this.fetch",level:b},{slug:"this_error",title:"this.error",level:b},{slug:"this_redirect",title:"this.redirect",level:b}],slug:h,file:"04-preloading.md"},{html:"\u003Cp\u003ESo far, we&#39;ve treated pages as entirely standalone components — upon navigation, the existing component will be destroyed, and a new one will take its place.\u003C\u002Fp\u003E\n\u003Cp\u003EBut in many apps, there are elements that should be visible on \u003Cem\u003Eevery\u003C\u002Fem\u003E page, such as top-level navigation or a footer. Instead of repeating them in every page, we can use \u003Cem\u003Elayout\u003C\u002Fem\u003E components.\u003C\u002Fp\u003E\n\u003Cp\u003ETo create a layout component that applies to every page, make a file called \u003Ccode\u003Esrc\u002Froutes\u002F_layout.svelte\u003C\u002Fcode\u003E. The default layout component (the one that Sapper uses if you don&#39;t bring your own) looks like this...\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-markup'\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Eslot\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Eslot\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E...but we can add whatever markup, styles and behaviour we want. For example, let&#39;s add a nav bar:\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-markup'\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-comment\"\u003E&lt;!-- src\u002Froutes\u002F_layout.svelte --&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Enav\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Ea\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Ehref\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\".\"\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003EHome\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Ea\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Ea\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Ehref\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"about\"\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003EAbout\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Ea\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Ea\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Ehref\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"settings\"\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003ESettings\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Ea\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Enav\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Eslot\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Eslot\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003EIf we create pages for \u003Ccode\u003E\u002F\u003C\u002Fcode\u003E, \u003Ccode\u003E\u002Fabout\u003C\u002Fcode\u003E and \u003Ccode\u003E\u002Fsettings\u003C\u002Fcode\u003E...\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-markup'\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-comment\"\u003E&lt;!-- src\u002Froutes\u002Findex.svelte --&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003EHome\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cdiv class=''\u003E\u003Cpre class='language-markup'\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-comment\"\u003E&lt;!-- src\u002Froutes\u002Fabout.svelte --&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003EAbout\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cdiv class=''\u003E\u003Cpre class='language-markup'\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-comment\"\u003E&lt;!-- src\u002Froutes\u002Fsettings.svelte --&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003ESettings\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E...the nav will always be visible, and clicking between the three pages will only result in the \u003Ccode\u003E&lt;h1&gt;\u003C\u002Fcode\u003E being replaced.\u003C\u002Fp\u003E\n\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"Nested_routes\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#Nested_routes\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tNested routes\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cp\u003ESuppose we don&#39;t just have a single \u003Ccode\u003E\u002Fsettings\u003C\u002Fcode\u003E page, but instead have nested pages like \u003Ccode\u003E\u002Fsettings\u002Fprofile\u003C\u002Fcode\u003E and \u003Ccode\u003E\u002Fsettings\u002Fnotifications\u003C\u002Fcode\u003E with a shared submenu (for a real-life example, see \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fsettings\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Egithub.com\u002Fsettings\u003C\u002Fa\u003E).\u003C\u002Fp\u003E\n\u003Cp\u003EWe can create a layout that only applies to pages below \u003Ccode\u003E\u002Fsettings\u003C\u002Fcode\u003E (while inheriting the root layout with the top-level nav):\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-markup'\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-comment\"\u003E&lt;!-- src\u002Froutes\u002Fsettings\u002F_layout.svelte --&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003ESettings\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Eh1\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Ediv\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Eclass\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"submenu\"\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Ea\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Ehref\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"settings\u002Fprofile\"\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003EProfile\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Ea\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Ea\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Ehref\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"settings\u002Fnotifications\"\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003ENotifications\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Ea\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Ediv\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Eslot\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Eslot\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003ELayout components receive a \u003Ccode\u003Esegment\u003C\u002Fcode\u003E property which is useful for things like styling:\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-diff'\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-addition\"\u003E+&lt;script&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-addition\"\u003E+    export let segment;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-addition\"\u003E+&lt;\u002Fscript&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-addition\"\u003E+\u003C\u002Fspan\u003E\n&lt;div class=\"submenu\"&gt;\n\u003Cspan class=\"hljs-deletion\"\u003E-    &lt;a href=\"settings\u002Fprofile\"&gt;Profile&lt;\u002Fa&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-deletion\"\u003E-    &lt;a href=\"settings\u002Fnotifications\"&gt;Notifications&lt;\u002Fa&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-addition\"\u003E+    &lt;a\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-addition\"\u003E+        class:selected={segment === \"profile\"}\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-addition\"\u003E+        href=\"settings\u002Fprofile\"\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-addition\"\u003E+    &gt;Profile&lt;\u002Fa&gt;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-addition\"\u003E+\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-addition\"\u003E+    &lt;a\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-addition\"\u003E+        class:selected={segment === \"notifications\"}\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-addition\"\u003E+        href=\"settings\u002Fnotifications\"\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-addition\"\u003E+    &gt;Notifications&lt;\u002Fa&gt;\u003C\u002Fspan\u003E\n&lt;\u002Fdiv&gt;\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E",metadata:{title:k},subsections:[{slug:"Nested_routes",title:"Nested routes",level:a}],slug:k,file:"05-layouts.md"},{html:"\u003Cp\u003ESapper, by default, renders server-side first (SSR), and then re-mounts any dynamic elements on the client. Svelte provides \u003Ca href=\"https:\u002F\u002Fsvelte.dev\u002Fdocs#Server-side_component_API\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Eexcellent support for this\u003C\u002Fa\u003E. This has benefits in performance and search engine indexing, among others, but comes with its own set of complexities.\u003C\u002Fp\u003E\n\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"Making_a_component_SSR_compatible\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#Making_a_component_SSR_compatible\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tMaking a component SSR compatible\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cp\u003ESapper works well with most third-party libraries you are likely to come across. However, sometimes, a third-party library comes bundled in a way which allows it to work with multiple different module loaders. Sometimes, this code creates a dependency on \u003Ccode\u003Ewindow\u003C\u002Fcode\u003E, such as checking for the existence of \u003Ccode\u003Ewindow.global\u003C\u002Fcode\u003E might do.\u003C\u002Fp\u003E\n\u003Cp\u003ESince there is no \u003Ccode\u003Ewindow\u003C\u002Fcode\u003E in a server-side environment like Sapper&#39;s, the action of simply importing such a module can cause the import to fail, and terminate the Sapper&#39;s server with an error such as:\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-bash'\u003E\u003Ccode\u003EReferenceError: window is not defined\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003EThe way to get around this is to use a dynamic import for your component, from within the \u003Ccode\u003EonMount\u003C\u002Fcode\u003E function (which is only called on the client), so that your import code is never called on the server.\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-markup'\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"javascript\"\u003E\n\t\u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E { onMount } \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E'svelte'\u003C\u002Fspan\u003E;\n\n\t\u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E MyComponent;\n\n\tonMount(\u003Cspan class=\"hljs-keyword\"\u003Easync\u003C\u002Fspan\u003E () =&gt; {\n\t\t\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-built_in\"\u003Emodule\u003C\u002Fspan\u003E = \u003Cspan class=\"hljs-keyword\"\u003Eawait\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-string\"\u003E'my-non-ssr-component'\u003C\u002Fspan\u003E);\n\t\tMyComponent = \u003Cspan class=\"hljs-built_in\"\u003Emodule\u003C\u002Fspan\u003E.default;\n\t});\n\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Esvelte:component\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Ethis\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E{MyComponent}\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Efoo\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"bar\"\u003C\u002Fspan\u003E\u002F&gt;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E",metadata:{title:"Server-side rendering"},subsections:[{slug:"Making_a_component_SSR_compatible",title:"Making a component SSR compatible",level:a}],slug:"Server-side_rendering",file:"06-server-side-rendering.md"},{html:"\u003Cp\u003EThe \u003Ccode\u003Epage\u003C\u002Fcode\u003E and \u003Ccode\u003Esession\u003C\u002Fcode\u003E values passed to \u003Ccode\u003Epreload\u003C\u002Fcode\u003E functions are available to components as \u003Ca href=\"https:\u002F\u002Fsvelte.dev\u002Ftutorial\u002Fwritable-stores\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Estores\u003C\u002Fa\u003E, along with \u003Ccode\u003Epreloading\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003EInside a component, get references to the stores like so:\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-markup'\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"javascript\"\u003E\n\t\u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E { stores } \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E'@sapper\u002Fapp'\u003C\u002Fspan\u003E;\n\t\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E { preloading, page, session } = stores();\n\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Escript\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cul\u003E\n\u003Cli\u003E\u003Ccode\u003Epreloading\u003C\u002Fcode\u003E contains a readonly boolean value, indicating whether or not a navigation is pending\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode\u003Epage\u003C\u002Fcode\u003E contains a readonly \u003Ccode\u003E{ host, path, params, query }\u003C\u002Fcode\u003E object, identical to that passed to \u003Ccode\u003Epreload\u003C\u002Fcode\u003E functions\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode\u003Esession\u003C\u002Fcode\u003E contains whatever data was seeded on the server. It is a \u003Ca href=\"https:\u002F\u002Fsvelte.dev\u002Ftutorial\u002Fwritable-stores\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Ewritable store\u003C\u002Fa\u003E, meaning you can update it with new data (for example, after the user logs in) and your app will be refreshed\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"Seeding_session_data\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#Seeding_session_data\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tSeeding session data\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cp\u003EOn the server, you can populate \u003Ccode\u003Esession\u003C\u002Fcode\u003E by passing an option to \u003Ccode\u003Esapper.middleware\u003C\u002Fcode\u003E:\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-javascript'\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F src\u002Fserver.js\u003C\u002Fspan\u003E\nexpress() \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F or Polka, or a similar framework\u003C\u002Fspan\u003E\n\t.use(\n\t\tserve(\u003Cspan class=\"hljs-string\"\u003E'static'\u003C\u002Fspan\u003E),\n\t\tauthenticationMiddleware(),\n\t\tsapper.middleware({\n\t\t\t\u003Cspan class=\"hljs-attr\"\u003Esession\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-function\"\u003E(\u003Cspan class=\"hljs-params\"\u003Ereq, res\u003C\u002Fspan\u003E) =&gt;\u003C\u002Fspan\u003E ({\n\t\t\t\t\u003Cspan class=\"hljs-attr\"\u003Euser\u003C\u002Fspan\u003E: req.user\n\t\t\t})\n\t\t})\n\t)\n\t.listen(process.env.PORT);\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cblockquote\u003E\n\u003Cp\u003ESession data must be serializable (using \u003Ca href=\"https:\u002F\u002Fgithub.com\u002FRich-Harris\u002Fdevalue\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Edevalue\u003C\u002Fa\u003E) — no functions or custom classes, just built-in JavaScript data types\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n",metadata:{title:l},subsections:[{slug:"Seeding_session_data",title:"Seeding session data",level:a}],slug:l,file:"07-state-management.md"},{html:"\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"rel_prefetch\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#rel_prefetch\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\trel=prefetch\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cp\u003ESapper uses code splitting to break your app into small chunks (one per route), ensuring fast startup times.\u003C\u002Fp\u003E\n\u003Cp\u003EFor \u003Cem\u003Edynamic\u003C\u002Fem\u003E routes, such as our \u003Ccode\u003Esrc\u002Froutes\u002Fblog\u002F[slug].svelte\u003C\u002Fcode\u003E example, that&#39;s not enough. In order to render the blog post, we need to fetch the data for it, and we can&#39;t do that until we know what \u003Ccode\u003Eslug\u003C\u002Fcode\u003E is. In the worst case, that could cause lag as the browser waits for the data to come back from the server.\u003C\u002Fp\u003E\n\u003Cp\u003EWe can mitigate that by \u003Cem\u003Eprefetching\u003C\u002Fem\u003E the data. Adding a \u003Ccode\u003Erel=prefetch\u003C\u002Fcode\u003E attribute to a link...\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-markup'\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Ea\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Erel\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003Eprefetch\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Ehref\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E'blog\u002Fwhat-is-sapper'\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003EWhat is Sapper?\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Ea\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E...will cause Sapper to run the page&#39;s \u003Ccode\u003Epreload\u003C\u002Fcode\u003E function as soon as the user hovers over the link (on a desktop) or touches it (on mobile), rather than waiting for the \u003Ccode\u003Eclick\u003C\u002Fcode\u003E event to trigger navigation. Typically, this buys us an extra couple of hundred milliseconds, which is the difference between a user interface that feels laggy, and one that feels snappy.\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003E\u003Ccode\u003Erel=prefetch\u003C\u002Fcode\u003E is a Sapper idiom, not a standard attribute for \u003Ccode\u003E&lt;a&gt;\u003C\u002Fcode\u003E elements\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003C!-- TODO add a function to prefetch programmatically --\u003E\n\n\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"rel_external\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#rel_external\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\trel=external\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cp\u003EBy default, the Sapper runtime intercepts clicks on \u003Ccode\u003E&lt;a&gt;\u003C\u002Fcode\u003E elements and bypasses the normal browser navigation for relative (same-origin) URLs that match one of your page routes. We sometimes need to tell Sapper that certain links need to be be handled by normal browser navigation.\u003C\u002Fp\u003E\n\u003Cp\u003EAdding a \u003Ccode\u003Erel=external\u003C\u002Fcode\u003E attribute to a link...\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-markup'\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Ea\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Erel\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003Eexternal\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Ehref\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E'path'\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003EPath\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Ea\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E...will trigger a browser navigation when the link is clicked.\u003C\u002Fp\u003E\n",metadata:{title:"Link options"},subsections:[{slug:"rel_prefetch",title:"rel=prefetch",level:a},{slug:"rel_external",title:"rel=external",level:a}],slug:"Link_options",file:"08-link-options.md"},{html:"\u003Cp\u003EUp until now we&#39;ve been using \u003Ccode\u003Esapper dev\u003C\u002Fcode\u003E to build our application and run a development server. But when it comes to production, we want to create a self-contained optimized build.\u003C\u002Fp\u003E\n\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"sapper_build\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#sapper_build\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tsapper build\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cp\u003EThis command packages up your application into the \u003Ccode\u003E__sapper__\u002Fbuild\u003C\u002Fcode\u003E directory. (You can change this to a custom directory, as well as controlling various other options — do \u003Ccode\u003Esapper build --help\u003C\u002Fcode\u003E for more information.)\u003C\u002Fp\u003E\n\u003Cp\u003EThe output is a Node app that you can run from the project root:\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-bash'\u003E\u003Ccode\u003Enode __sapper__\u002Fbuild\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"Browser_support\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#Browser_support\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tBrowser support\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cp\u003EYour site is built only for the latest versions of modern evergreen browsers by default. If you are using Rollup, you can use the \u003Ccode\u003E--legacy\u003C\u002Fcode\u003E\u003Csup\u003E1\u003C\u002Fsup\u003E flag to build a second bundle that can be used to support legacy browsers like Internet Explorer. Sapper will then serve up the correct bundle at runtime\u003Csup\u003E2\u003C\u002Fsup\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003EWhen using \u003Ccode\u003E--legacy\u003C\u002Fcode\u003E, Sapper will pass an environment variable \u003Ccode\u003ESAPPER_LEGACY_BUILD\u003C\u002Fcode\u003E to your Rollup config. Sapper will then build your client-side bundle twice: once with \u003Ccode\u003ESAPPER_LEGACY_BUILD\u003C\u002Fcode\u003E set to \u003Ccode\u003Etrue\u003C\u002Fcode\u003E and once with it set to \u003Ccode\u003Efalse\u003C\u002Fcode\u003E. \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fsveltejs\u002Fsapper-template-rollup\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Esapper-template-rollup\u003C\u002Fa\u003E provides an example of utilizing this configuration.\u003Csup\u003E3\u003C\u002Fsup\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EYou may wish to add this flag to a script in your \u003Ccode\u003Epackage.json\u003C\u002Fcode\u003E:\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-javascript'\u003E\u003Ccode\u003E  \u003Cspan class=\"hljs-string\"\u003E\"scripts\"\u003C\u002Fspan\u003E: {\n\t\u003Cspan class=\"hljs-string\"\u003E\"build\"\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-string\"\u003E\"sapper build --legacy\"\u003C\u002Fspan\u003E,\n  },\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Col\u003E\n\u003Cli\u003EThis option is unrelated to Svelte&#39;s \u003Ccode\u003Elegacy\u003C\u002Fcode\u003E option\u003C\u002Fli\u003E\n\u003Cli\u003EBrowsers which do not support \u003Ccode\u003Easync\u002Fawait\u003C\u002Fcode\u003E syntax will be served the legacy bundle\u003C\u002Fli\u003E\n\u003Cli\u003EYou will also need to polyfill APIs that are not present in older browsers.\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n",metadata:{title:m},subsections:[{slug:"sapper_build",title:"sapper build",level:a},{slug:"Browser_support",title:"Browser support",level:a}],slug:m,file:"09-building.md"},{html:"\u003Cp\u003EMany sites are effectively \u003Cem\u003Estatic\u003C\u002Fem\u003E, which is to say they don&#39;t actually need an Express server backing them. Instead, they can be hosted and served as static files, which allows them to be deployed to more hosting environments (such as \u003Ca href=\"https:\u002F\u002Fwww.netlify.com\u002F\" target=\"_blank\" rel=\"noopener noreferrer\"\u003ENetlify\u003C\u002Fa\u003E or \u003Ca href=\"https:\u002F\u002Fpages.github.com\u002F\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EGitHub Pages\u003C\u002Fa\u003E). Static sites are generally cheaper to operate and have better performance characteristics.\u003C\u002Fp\u003E\n\u003Cp\u003ESapper allows you to \u003Cem\u003Eexport\u003C\u002Fem\u003E a static site with a single zero-config \u003Ccode\u003Esapper export\u003C\u002Fcode\u003E command. In fact, you&#39;re looking at an exported site right now!\u003C\u002Fp\u003E\n\u003Cp\u003EStatic doesn&#39;t mean non-interactive — your Svelte components work exactly as they do normally, and you still get all the benefits of client-side routing and prefetching.\u003C\u002Fp\u003E\n\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"sapper_export\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#sapper_export\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tsapper export\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cp\u003EInside your Sapper project, try this:\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-bash'\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-comment\"\u003E# npx allows you to use locally-installed dependencies\u003C\u002Fspan\u003E\nnpx sapper \u003Cspan class=\"hljs-built_in\"\u003Eexport\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003EThis will create a \u003Ccode\u003E__sapper__\u002Fexport\u003C\u002Fcode\u003E folder with a production-ready build of your site. You can launch it like so:\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-bash'\u003E\u003Ccode\u003Enpx serve __sapper__\u002F\u003Cspan class=\"hljs-built_in\"\u003Eexport\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003ENavigate to \u003Ca href=\"http:\u002F\u002Flocalhost:5000\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Elocalhost:5000\u003C\u002Fa\u003E (or whatever port \u003Ccode\u003Eserve\u003C\u002Fcode\u003E picked), and verify that your site works as expected.\u003C\u002Fp\u003E\n\u003Cp\u003EYou can also add a script to your package.json...\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-javascript'\u003E\u003Ccode\u003E{\n\t\u003Cspan class=\"hljs-string\"\u003E\"scripts\"\u003C\u002Fspan\u003E: {\n\t\t...\n\t\t\u003Cspan class=\"hljs-string\"\u003E\"export\"\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-string\"\u003E\"sapper export\"\u003C\u002Fspan\u003E\n\t}\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E...allowing you to \u003Ccode\u003Enpm run export\u003C\u002Fcode\u003E your app.\u003C\u002Fp\u003E\n\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"How_it_works\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#How_it_works\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tHow it works\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cp\u003EWhen you run \u003Ccode\u003Esapper export\u003C\u002Fcode\u003E, Sapper first builds a production version of your app, as though you had run \u003Ccode\u003Esapper build\u003C\u002Fcode\u003E, and copies the contents of your \u003Ccode\u003Estatic\u003C\u002Fcode\u003E folder to the destination. It then starts the server, and navigates to the root of your app. From there, it follows any \u003Ccode\u003E&lt;a&gt;\u003C\u002Fcode\u003E elements it finds, and captures any data served by the app.\u003C\u002Fp\u003E\n\u003Cp\u003EBecause of this, any pages you want to be included in the exported site must either be reachable by \u003Ccode\u003E&lt;a&gt;\u003C\u002Fcode\u003E elements or added to the \u003Ccode\u003E--entry\u003C\u002Fcode\u003E option of the \u003Ccode\u003Esapper export\u003C\u002Fcode\u003E command.\u003C\u002Fp\u003E\n\u003Cp\u003EThe \u003Ccode\u003E--entry\u003C\u002Fcode\u003E option expects a string of space-separated values. Examples:\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-bash'\u003E\u003Ccode\u003Esapper \u003Cspan class=\"hljs-built_in\"\u003Eexport\u003C\u002Fspan\u003E --entry \u003Cspan class=\"hljs-string\"\u003E\"some-page some-other-page\"\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003ESetting \u003Ccode\u003E--entry\u003C\u002Fcode\u003E overwrites any defaults. If you wish to add export entrypoints \u003Cem\u003Ein addition\u003C\u002Fem\u003E to \u003Ccode\u003E\u002F\u003C\u002Fcode\u003E then make sure to add \u003Ccode\u003E\u002F\u003C\u002Fcode\u003E as well or \u003Ccode\u003Esapper export\u003C\u002Fcode\u003E will not visit the index route.\u003C\u002Fp\u003E\n\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"When_not_to_export\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#When_not_to_export\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tWhen not to export\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cp\u003EThe basic rule is this: for an app to be exportable, any two users hitting the same page of your app must get the same content from the server. In other words, any app that involves user sessions or authentication is \u003Cem\u003Enot\u003C\u002Fem\u003E a candidate for \u003Ccode\u003Esapper export\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003ENote that you can still export apps with dynamic routes, like our \u003Ccode\u003Esrc\u002Froutes\u002Fblog\u002F[slug].svelte\u003C\u002Fcode\u003E example from earlier. \u003Ccode\u003Esapper export\u003C\u002Fcode\u003E will intercept \u003Ccode\u003Efetch\u003C\u002Fcode\u003E requests made inside \u003Ccode\u003Epreload\u003C\u002Fcode\u003E, so the data served from \u003Ccode\u003Esrc\u002Froutes\u002Fblog\u002F[slug].json.js\u003C\u002Fcode\u003E will also be captured.\u003C\u002Fp\u003E\n\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"Route_conflicts\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#Route_conflicts\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tRoute conflicts\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cp\u003EBecause \u003Ccode\u003Esapper export\u003C\u002Fcode\u003E writes to the filesystem, it isn&#39;t possible to have two server routes that would cause a directory and a file to have the same name. For example, \u003Ccode\u003Esrc\u002Froutes\u002Ffoo\u002Findex.js\u003C\u002Fcode\u003E and \u003Ccode\u003Esrc\u002Froutes\u002Ffoo\u002Fbar.js\u003C\u002Fcode\u003E would try to create \u003Ccode\u003Eexport\u002Ffoo\u003C\u002Fcode\u003E and \u003Ccode\u003Eexport\u002Ffoo\u002Fbar\u003C\u002Fcode\u003E, which is impossible.\u003C\u002Fp\u003E\n\u003Cp\u003EThe solution is to rename one of the routes to avoid conflict — for example, \u003Ccode\u003Esrc\u002Froutes\u002Ffoo-bar.js\u003C\u002Fcode\u003E. (Note that you would also need to update any code that fetches data from \u003Ccode\u003E\u002Ffoo\u002Fbar\u003C\u002Fcode\u003E to reference \u003Ccode\u003E\u002Ffoo-bar\u003C\u002Fcode\u003E instead.)\u003C\u002Fp\u003E\n\u003Cp\u003EFor \u003Cem\u003Epages\u003C\u002Fem\u003E, we skirt around this problem by writing \u003Ccode\u003Eexport\u002Ffoo\u002Findex.html\u003C\u002Fcode\u003E instead of \u003Ccode\u003Eexport\u002Ffoo\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n",metadata:{title:n},subsections:[{slug:"sapper_export",title:"sapper export",level:a},{slug:"How_it_works",title:"How it works",level:a},{slug:"When_not_to_export",title:"When not to export",level:a},{slug:"Route_conflicts",title:"Route conflicts",level:a}],slug:n,file:"10-exporting.md"},{html:"\u003Cp\u003ESapper apps run anywhere that supports Node 8 or higher.\u003C\u002Fp\u003E\n\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"Deploying_to_Vercel\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#Deploying_to_Vercel\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tDeploying to Vercel\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cp\u003EWe can use a third-party library like \u003Ca href=\"https:\u002F\u002Fwww.npmjs.com\u002Fpackage\u002Fvercel-sapper\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Ethe \u003Ccode\u003Evercel-sapper\u003C\u002Fcode\u003E builder\u003C\u002Fa\u003E to deploy our projects to \u003Ca href=\"https:\u002F\u002Fvercel.com\u002Fhome\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EVercel\u003C\u002Fa\u003E (\u003Ca href=\"https:\u002F\u002Fvercel.com\u002Fblog\u002Fzeit-is-now-vercel\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Eformerly ZEIT Now\u003C\u002Fa\u003E). See \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fthgh\u002Fvercel-sapper#readme\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Ethat project&#39;s readme\u003C\u002Fa\u003E for more details regarding \u003Ca href=\"https:\u002F\u002Fvercel.com\u002Fhome\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EVercel\u003C\u002Fa\u003E deployments.\u003C\u002Fp\u003E\n\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"Deploying_service_workers\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#Deploying_service_workers\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tDeploying service workers\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cp\u003ESapper makes the Service Worker file (\u003Ccode\u003Eservice-worker.js\u003C\u002Fcode\u003E) unique by including a timestamp in the source code\n(calculated using \u003Ccode\u003EDate.now()\u003C\u002Fcode\u003E).\u003C\u002Fp\u003E\n\u003Cp\u003EIn environments where the app is deployed to multiple servers (such as \u003Ca href=\"https:\u002F\u002Fvercel.com\u002Fhome\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EVercel\u003C\u002Fa\u003E), it is advisable to use a\nconsistent timestamp for all deployments. Otherwise, users may run into issues where the Service Worker\nupdates unexpectedly because the app hits server 1, then server 2, and they have slightly different timestamps.\u003C\u002Fp\u003E\n\u003Cp\u003ETo override Sapper&#39;s timestamp, you can use an environment variable (e.g. \u003Ccode\u003ESAPPER_TIMESTAMP\u003C\u002Fcode\u003E) and then modify\nthe \u003Ccode\u003Eservice-worker.js\u003C\u002Fcode\u003E:\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-javascript'\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E timestamp = process.env.SAPPER_TIMESTAMP; \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F instead of `import { timestamp }`\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E ASSETS = \u003Cspan class=\"hljs-string\"\u003E`cache\u003Cspan class=\"hljs-subst\"\u003E${timestamp}\u003C\u002Fspan\u003E`\u003C\u002Fspan\u003E;\n\n\u003Cspan class=\"hljs-keyword\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Edefault\u003C\u002Fspan\u003E {\n\t\u003Cspan class=\"hljs-comment\"\u003E\u002F* ... *\u002F\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"hljs-attr\"\u003Eplugins\u003C\u002Fspan\u003E: [\n\t\t\u003Cspan class=\"hljs-comment\"\u003E\u002F* ... *\u002F\u003C\u002Fspan\u003E\n\t\treplace({\n\t\t\t\u003Cspan class=\"hljs-comment\"\u003E\u002F* ... *\u002F\u003C\u002Fspan\u003E\n\t\t\t\u003Cspan class=\"hljs-string\"\u003E'process.env.SAPPER_TIMESTAMP'\u003C\u002Fspan\u003E: process.env.SAPPER_TIMESTAMP || \u003Cspan class=\"hljs-built_in\"\u003EDate\u003C\u002Fspan\u003E.now()\n\t\t})\n\t]\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003EThen you can set it using the environment variable, e.g.:\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-bash'\u003E\u003Ccode\u003ESAPPER_TIMESTAMP=$(date +%s%3N) npm run build\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003EWhen deploying to \u003Ca href=\"https:\u002F\u002Fvercel.com\u002Fhome\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EVercel\u003C\u002Fa\u003E, you can pass the environment variable into the Vercel CLI tool itself:\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-bash'\u003E\u003Ccode\u003Evercel -e SAPPER_TIMESTAMP=$(date +%s%3N)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E",metadata:{title:o},subsections:[{slug:"Deploying_to_Vercel",title:"Deploying to Vercel",level:a},{slug:"Deploying_service_workers",title:"Deploying service workers",level:a}],slug:o,file:"11-deploying.md"},{html:"\u003Cp\u003EBy default, Sapper does not add security headers to your app, but you may add them yourself using middleware such as \u003Ca href=\"https:\u002F\u002Fhelmetjs.github.io\u002F\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EHelmet\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"Content_Security_Policy_CSP\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#Content_Security_Policy_CSP\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tContent Security Policy (CSP)\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cp\u003ESapper generates inline \u003Ccode\u003E&lt;script&gt;\u003C\u002Fcode\u003Es, which can fail to execute if \u003Ca href=\"https:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FWeb\u002FHTTP\u002FCSP\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EContent Security Policy (CSP)\u003C\u002Fa\u003E headers disallow arbitrary script execution (\u003Ccode\u003Eunsafe-inline\u003C\u002Fcode\u003E).\u003C\u002Fp\u003E\n\u003Cp\u003ETo work around this, Sapper can inject a \u003Ca href=\"https:\u002F\u002Fwww.troyhunt.com\u002Flocking-down-your-website-scripts-with-csp-hashes-nonces-and-report-uri\u002F\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Enonce\u003C\u002Fa\u003E which can be configured with middleware to emit the proper CSP headers. Here is an example using \u003Ca href=\"https:\u002F\u002Fexpressjs.com\u002F\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EExpress\u003C\u002Fa\u003E and \u003Ca href=\"https:\u002F\u002Fhelmetjs.github.io\u002F\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EHelmet\u003C\u002Fa\u003E:\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-javascript'\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F server.js\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E uuidv4 \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E'uuid\u002Fv4'\u003C\u002Fspan\u003E;\n\u003Cspan class=\"hljs-keyword\"\u003Eimport\u003C\u002Fspan\u003E helmet \u003Cspan class=\"hljs-keyword\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E'helmet'\u003C\u002Fspan\u003E;\n\napp.use(\u003Cspan class=\"hljs-function\"\u003E(\u003Cspan class=\"hljs-params\"\u003Ereq, res, next\u003C\u002Fspan\u003E) =&gt;\u003C\u002Fspan\u003E {\n\tres.locals.nonce = uuidv4();\n\tnext();\n});\napp.use(helmet({\n\t\u003Cspan class=\"hljs-attr\"\u003EcontentSecurityPolicy\u003C\u002Fspan\u003E: {\n\t\t\u003Cspan class=\"hljs-attr\"\u003Edirectives\u003C\u002Fspan\u003E: {\n\t\t\t\u003Cspan class=\"hljs-attr\"\u003EscriptSrc\u003C\u002Fspan\u003E: [\n\t\t\t\t\u003Cspan class=\"hljs-string\"\u003E\"'self'\"\u003C\u002Fspan\u003E,\n\t\t\t\t(req, res) =&gt; \u003Cspan class=\"hljs-string\"\u003E`'nonce-\u003Cspan class=\"hljs-subst\"\u003E${res.locals.nonce}\u003C\u002Fspan\u003E'`\u003C\u002Fspan\u003E\n\t\t\t]\n\t\t}\n\t}\n}));\napp.use(sapper.middleware());\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003EUsing \u003Ccode\u003Eres.locals.nonce\u003C\u002Fcode\u003E in this way follows the convention set by\n\u003Ca href=\"https:\u002F\u002Fhelmetjs.github.io\u002Fdocs\u002Fcsp\u002F#generating-nonces\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EHelmet&#39;s CSP docs\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n",metadata:{title:p},subsections:[{slug:"Content_Security_Policy_CSP",title:"Content Security Policy (CSP)",level:a}],slug:p,file:"12-security.md"},{html:"\u003Cp\u003EOrdinarily, the root of your Sapper app is served at \u003Ccode\u003E\u002F\u003C\u002Fcode\u003E. But in some cases, your app may need to be served from a different base path — for example, if Sapper only controls part of your domain, or if you have multiple Sapper apps living side-by-side.\u003C\u002Fp\u003E\n\u003Cp\u003EThis can be done like so:\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-javascript'\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F app\u002Fserver.js\u003C\u002Fspan\u003E\n\nexpress() \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F or Polka, or a similar framework\u003C\u002Fspan\u003E\n\t.use(\n\t\t\u003Cspan class=\"hljs-string\"\u003E'\u002Fmy-base-path'\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F &lt;!-- add this line\u003C\u002Fspan\u003E\n\t\tcompression({ \u003Cspan class=\"hljs-attr\"\u003Ethreshold\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E }),\n\t\tserve(\u003Cspan class=\"hljs-string\"\u003E'static'\u003C\u002Fspan\u003E),\n\t\tsapper.middleware()\n\t)\n\t.listen(process.env.PORT);\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003ESapper will detect the base path and configure both the server-side and client-side routers accordingly.\u003C\u002Fp\u003E\n\u003Cp\u003EIf you&#39;re \u003Ca href=\"docs#Exporting\" rel=\"noopener noreferrer\"\u003Eexporting\u003C\u002Fa\u003E your app, you will need to tell the exporter where to begin crawling:\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-bash'\u003E\u003Ccode\u003Esapper \u003Cspan class=\"hljs-built_in\"\u003Eexport\u003C\u002Fspan\u003E --basepath my-base-path\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E",metadata:{title:"Base URLs"},subsections:[],slug:"Base_URLs",file:"13-base-urls.md"},{html:"\u003Cp\u003EYou can use whatever testing frameworks and libraries you&#39;d like. The default in \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fsveltejs\u002Fsapper-template\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Esapper-template\u003C\u002Fa\u003E is \u003Ca href=\"https:\u002F\u002Fcypress.io\" target=\"_blank\" rel=\"noopener noreferrer\"\u003ECypress\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\n\t\t\t\t\t\u003Ch3\u003E\n\t\t\t\t\t\t\u003Cspan id=\"Running_the_tests\" class=\"offset-anchor\" \u003E\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Ca href=\"docs#Running_the_tests\" class=\"anchor\" aria-hidden=\"true\"\u003E\u003C\u002Fa\u003E\n\t\t\t\t\t\tRunning the tests\n\t\t\t\t\t\u003C\u002Fh3\u003E\u003Cdiv class=''\u003E\u003Cpre class='language-bash'\u003E\u003Ccode\u003Enpm \u003Cspan class=\"hljs-built_in\"\u003Etest\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003EThis will start the server and open Cypress. You can (and should!) add your own tests in \u003Ccode\u003Ecypress\u002Fintegration\u002Fspec.js\u003C\u002Fcode\u003E — consult the \u003Ca href=\"https:\u002F\u002Fdocs.cypress.io\u002Fguides\u002Foverview\u002Fwhy-cypress.html\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Edocs\u003C\u002Fa\u003E for more information.\u003C\u002Fp\u003E\n",metadata:{title:q},subsections:[{slug:"Running_the_tests",title:"Running the tests",level:a}],slug:q,file:"14-testing.md"},{html:"\u003Cp\u003EDebugging your server code is particularly easy with \u003Ca href=\"https:\u002F\u002Fgithub.com\u002FGoogleChromeLabs\u002Fndb\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Endb\u003C\u002Fa\u003E. Install it globally...\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-bash'\u003E\u003Ccode\u003Enpm install -g ndb\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E...then run Sapper:\u003C\u002Fp\u003E\n\u003Cdiv class=''\u003E\u003Cpre class='language-bash'\u003E\u003Ccode\u003Endb npm run dev\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cblockquote\u003E\n\u003Cp\u003EThis assumes that \u003Ccode\u003Enpm run dev\u003C\u002Fcode\u003E runs \u003Ccode\u003Esapper dev\u003C\u002Fcode\u003E. You can also run Sapper via \u003Ca href=\"https:\u002F\u002Fblog.npmjs.org\u002Fpost\u002F162869356040\u002Fintroducing-npx-an-npm-package-runner\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Enpx\u003C\u002Fa\u003E, as in \u003Ccode\u003Endb npx sapper dev\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Cp\u003ENote that you may not see any terminal output for a few seconds while ndb starts up.\u003C\u002Fp\u003E\n",metadata:{title:r},subsections:[],slug:r,file:"15-debugging.md"}]}}(3,4,"Introduction","src","static","Routing","Pages","Preloading","Arguments","Context","Layouts","Stores","Building","Exporting","Deployment","Security","Testing","Debugging"))]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');(function(){try{eval("async function x(){}");var main="/client/client.2a1e3520.js"}catch(e){main="/client/legacy/client.541f5987.js"};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src=main;s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@1.0.1.js";s.setAttribute("data-main",main);}document.head.appendChild(s);}());</script> 